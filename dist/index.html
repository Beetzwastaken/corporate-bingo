<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EngineerMemes.AI - Turn suffering into content</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        blue: {
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8'
                        }
                    },
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        body { 
            font-family: 'Inter', 'system-ui', sans-serif; 
            background: #f9fafb;
        }
        
        .pain-meter { 
            background: linear-gradient(to right, #10b981 0%, #f59e0b 50%, #ef4444 100%); 
        }
        
        .template-card {
            border: 2px solid transparent;
            transition: border-color 0.15s ease;
        }
        
        .template-card:hover {
            border-color: #3b82f6;
        }
        
        .template-card.selected {
            border-color: #3b82f6;
            background: #f0f9ff;
        }
        
        .control-input {
            transition: border-color 0.15s ease;
        }
        
        .control-input:focus {
            border-color: #3b82f6;
            outline: none;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
    </style>
</head>
<body>
    <!-- Minimal Header Bar -->
    <header class="bg-white border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-2xl font-bold text-gray-900">EngineerMemes.AI</h1>
                    <p class="text-sm text-gray-600">Turn suffering into content</p>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-right">
                        <div class="text-lg font-semibold text-blue-600" id="painScore">5/10</div>
                        <div class="text-xs text-gray-500">Pain Level</div>
                    </div>
                    <div class="w-32 h-3 bg-gray-200 rounded-full">
                        <div id="painBar" class="h-3 rounded-full pain-meter" style="width: 50%"></div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <!-- Left Column - Controls -->
            <div class="space-y-6">
                
                <!-- Pain Input -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                    <h2 class="text-lg font-semibold text-gray-900 mb-4">Describe your engineering pain</h2>
                    <textarea 
                        id="painInput" 
                        class="control-input w-full p-3 border border-gray-300 rounded-lg resize-none" 
                        rows="4" 
                        placeholder="e.g., Client wants to change the spec after we finished fabrication and testing..."
                        oninput="analyzePain(this.value)"
                    ></textarea>
                    <div class="mt-3 text-xs text-gray-500" id="painMessage">Standard engineering suffering</div>
                </div>

                <!-- Template Selector -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                    <h2 class="text-lg font-semibold text-gray-900 mb-4">Choose template</h2>
                    <div class="grid grid-cols-2 gap-3" id="templates">
                        <!-- Templates will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Text Customization -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                    <h2 class="text-lg font-semibold text-gray-900 mb-4">Customize text</h2>
                    <div id="textInputs">
                        <div class="text-center py-8 text-gray-500">
                            <div class="text-2xl mb-2">üéØ</div>
                            <p class="text-sm">Select a template above to customize text</p>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Right Column - Preview -->
            <div class="space-y-6">
                
                <!-- Meme Preview -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                    <h2 class="text-lg font-semibold text-gray-900 mb-4">Preview</h2>
                    <div class="flex justify-center mb-4">
                        <canvas id="memeCanvas" width="400" height="400" class="border border-gray-300 rounded-lg bg-gray-50 max-w-full h-auto"></canvas>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="flex gap-3">
                        <button onclick="generateMeme()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium">
                            Generate Meme
                        </button>
                        <button onclick="downloadMeme()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium">
                            Download
                        </button>
                        <button onclick="copyToClipboard()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium">
                            Copy
                        </button>
                    </div>
                </div>

            </div>
            
        </div>
    </main>

    <script>
        // Engineering Meme Generator - Professional JavaScript Implementation
        
        let currentTemplate = null;
        let currentPainScore = 5;
        let generatedMemes = [];

        // Engineering-specific pain keywords and scoring
        const painKeywords = {
            high: ['deadline', 'urgent', 'asap', 'broken', 'failed', 'disaster', 'emergency', 'critical'],
            medium: ['change', 'modify', 'meeting', 'review', 'delay', 'client', 'scope'],
            low: ['working', 'progress', 'complete', 'success', 'fixed', 'approved']
        };

        // Meme templates with engineering themes
        const memeTemplates = [
            {
                id: 'drake',
                name: 'Drake Choice',
                category: 'general',
                textAreas: [
                    { id: 'reject', placeholder: 'Following the spec', x: 50, y: 25 },
                    { id: 'accept', placeholder: 'Client changes everything', x: 50, y: 75 }
                ]
            },
            {
                id: 'this-is-fine',
                name: 'This is Fine',
                category: 'general',
                textAreas: [
                    { id: 'top', placeholder: 'Production is down', x: 50, y: 20 },
                    { id: 'bottom', placeholder: 'This is fine', x: 50, y: 80 }
                ]
            },
            {
                id: 'two-buttons',
                name: 'Two Buttons',
                category: 'general',
                textAreas: [
                    { id: 'button1', placeholder: 'Fix the bug properly', x: 25, y: 30 },
                    { id: 'button2', placeholder: 'Quick hotfix to prod', x: 75, y: 30 }
                ]
            },
            {
                id: 'distracted',
                name: 'Distracted Engineer',
                category: 'software',
                textAreas: [
                    { id: 'girlfriend', placeholder: 'Current project', x: 25, y: 70 },
                    { id: 'boyfriend', placeholder: 'Me', x: 50, y: 80 },
                    { id: 'other_woman', placeholder: 'New shiny framework', x: 75, y: 60 }
                ]
            }
        ];

        // Initialize the app
        function initApp() {
            console.log('üöÄ Initializing EngineerMemes.AI...');
            
            // Verify all DOM elements exist
            const painInput = document.getElementById('painInput');
            const templates = document.getElementById('templates');
            const textInputs = document.getElementById('textInputs');
            const memeCanvas = document.getElementById('memeCanvas');
            
            console.log('DOM Elements Check:');
            console.log('- painInput:', painInput ? '‚úÖ' : '‚ùå');
            console.log('- templates:', templates ? '‚úÖ' : '‚ùå');
            console.log('- textInputs:', textInputs ? '‚úÖ' : '‚ùå');
            console.log('- memeCanvas:', memeCanvas ? '‚úÖ' : '‚ùå');
            
            renderTemplates();
            
            // Don't auto-select a template - let user choose
            renderTextInputs(); // This will show the "Select a Template" message
            updateCanvas(); // This will show empty canvas
            
            console.log('‚úÖ App initialized successfully');
            console.log('üìä Templates loaded:', memeTemplates.length);
        }

        // Analyze engineering pain level
        function analyzePain(input) {
            console.log('üîç Analyzing pain:', input.length > 0 ? 'Text provided' : 'Empty input');
            
            if (!input.trim()) {
                updatePainScore(5);
                return;
            }

            const lower = input.toLowerCase();
            let score = 5;
            let triggers = [];

            painKeywords.high.forEach(keyword => {
                if (lower.includes(keyword)) {
                    score += 2;
                    triggers.push(`+2 (${keyword})`);
                }
            });
            
            painKeywords.medium.forEach(keyword => {
                if (lower.includes(keyword)) {
                    score += 1;
                    triggers.push(`+1 (${keyword})`);
                }
            });
            
            painKeywords.low.forEach(keyword => {
                if (lower.includes(keyword)) {
                    score -= 1;
                    triggers.push(`-1 (${keyword})`);
                }
            });

            score = Math.max(1, Math.min(10, Math.round(score)));
            
            console.log('üìä Pain analysis result:');
            console.log('- Base score: 5');
            console.log('- Triggers:', triggers.length > 0 ? triggers.join(', ') : 'none');
            console.log('- Final score:', score);
            
            updatePainScore(score);
        }

        // Update pain score display
        function updatePainScore(score) {
            currentPainScore = score;
            const scoreElement = document.getElementById('painScore');
            const barElement = document.getElementById('painBar');
            const messageElement = document.getElementById('painMessage');

            scoreElement.textContent = score + '/10';
            barElement.style.width = (score * 10) + '%';

            const messages = {
                1: 'Mild engineering annoyance',
                2: 'Slight project turbulence',
                3: 'Minor technical hiccup', 
                4: 'Standard development friction',
                5: 'Typical engineering suffering',
                6: 'Elevated stress protocols',
                7: 'Approaching critical pain levels',
                8: 'High-stress engineering zone',
                9: 'MAXIMUM SUFFERING DETECTED',
                10: 'ENGINEERING EMERGENCY STATE'
            };

            messageElement.textContent = messages[score] || 'Unknown pain level';
        }

        // Render meme templates
        function renderTemplates() {
            const container = document.getElementById('templates');
            container.innerHTML = memeTemplates.map((template, index) => 
                `<div onclick="selectTemplate(${JSON.stringify(template).replace(/"/g, '&quot;')})" 
                      class="template-card cursor-pointer p-4 rounded-lg border border-gray-300 bg-white hover:border-blue-500" id="template-${template.id}">
                    <div class="text-center">
                        <div class="w-12 h-12 bg-gray-100 rounded-lg mb-3 flex items-center justify-center text-xl mx-auto">
                            ${getTemplateIcon(template.category)}
                        </div>
                        <h4 class="text-sm font-medium text-gray-900 mb-1">${template.name}</h4>
                        <p class="text-xs text-gray-500">${template.textAreas.length} text field${template.textAreas.length === 1 ? '' : 's'}</p>
                    </div>
                </div>`
            ).join('');
        }

        // Get template icon
        function getTemplateIcon(category) {
            const icons = {
                general: 'üé≠',
                software: 'üíª', 
                mechanical: '‚öôÔ∏è',
                electrical: '‚ö°',
                civil: 'üèóÔ∏è',
                chemical: 'üß™'
            };
            return icons[category] || 'üéØ';
        }

        // Select a template
        function selectTemplate(template) {
            console.log('üéØ Template selected:', template.name);
            currentTemplate = template;
            
            // Update active template styling
            document.querySelectorAll('.template-card').forEach(el => {
                el.classList.remove('selected');
                el.classList.remove('border-blue-500');
                el.classList.add('border-gray-300');
            });
            
            const selectedCard = document.getElementById(`template-${template.id}`);
            if (selectedCard) {
                selectedCard.classList.add('selected');
                selectedCard.classList.remove('border-gray-300');
                selectedCard.classList.add('border-blue-500');
                console.log('‚úÖ Template card styling updated');
            } else {
                console.error('‚ùå Template card not found:', `template-${template.id}`);
            }
            
            // Render text inputs
            renderTextInputs();
            updateCanvas();
            console.log('‚úÖ Template selection complete');
        }

        // Render text input fields
        function renderTextInputs() {
            const container = document.getElementById('textInputs');
            if (!currentTemplate) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <div class="text-2xl mb-2">üéØ</div>
                        <p class="text-sm">Select a template above to customize text</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = currentTemplate.textAreas.map((area, index) => 
                `<div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        ${getAreaLabel(area.id)}
                    </label>
                    <input 
                        type="text" 
                        id="text_${area.id}"
                        placeholder="${area.placeholder}"
                        class="control-input w-full p-3 border border-gray-300 rounded-lg text-sm"
                        oninput="updateCanvas()"
                        maxlength="100"
                    />
                </div>`
            ).join('');
        }

        // Get area label
        function getAreaLabel(areaId) {
            const labels = {
                top: 'Top Text',
                bottom: 'Bottom Text', 
                reject: 'Reject/No',
                accept: 'Accept/Yes',
                button1: 'Button 1',
                button2: 'Button 2',
                girlfriend: 'Current Thing',
                boyfriend: 'Person',
                other_woman: 'New Thing'
            };
            return labels[areaId] || 'Text';
        }

        // Update canvas
        function updateCanvas() {
            const canvas = document.getElementById('memeCanvas');
            const ctx = canvas.getContext('2d');
            
            // Clear canvas
            ctx.fillStyle = '#f8fafc';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw border
            ctx.strokeStyle = '#e2e8f0';
            ctx.lineWidth = 2;
            ctx.strokeRect(0, 0, canvas.width, canvas.height);

            if (!currentTemplate) return;

            // Draw template background
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(10, 10, canvas.width - 20, canvas.height - 20);

            // Draw template indicator
            ctx.fillStyle = '#3b82f6';
            ctx.font = 'bold 16px Inter';
            ctx.textAlign = 'center';
            ctx.fillText(currentTemplate.name.toUpperCase(), canvas.width / 2, 30);

            // Draw text areas
            currentTemplate.textAreas.forEach(area => {
                const input = document.getElementById('text_' + area.id);
                const text = input ? input.value || area.placeholder : area.placeholder;
                
                const x = (area.x / 100) * canvas.width;
                const y = (area.y / 100) * canvas.height;
                
                // Set text style
                ctx.font = 'bold 24px Impact, Arial Black';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                // Draw text stroke
                ctx.strokeStyle = '#000000';
                ctx.lineWidth = 3;
                ctx.strokeText(text, x, y);
                
                // Draw text fill
                ctx.fillStyle = '#ffffff';
                ctx.fillText(text, x, y);
            });

            // Add pain level indicator
            ctx.fillStyle = '#6b7280';
            ctx.font = '12px Inter';
            ctx.textAlign = 'right';
            ctx.fillText(`Pain Level: ${currentPainScore}/10`, canvas.width - 10, canvas.height - 10);
        }

        // Generate meme (just update canvas for now)
        function generateMeme() {
            console.log('üéØ Generate Meme button clicked');
            
            if (!currentTemplate) {
                alert('Please select a template first!');
                return;
            }
            
            updateCanvas();
            
            // Add generation timestamp
            const canvas = document.getElementById('memeCanvas');
            if (!canvas) {
                console.error('‚ùå Canvas not found');
                return;
            }
            
            const ctx = canvas.getContext('2d');
            
            ctx.fillStyle = '#10b981';
            ctx.font = '10px Inter';
            ctx.textAlign = 'left';
            ctx.fillText(`Generated: ${new Date().toLocaleTimeString()}`, 10, canvas.height - 10);
            
            // Store in memory
            const texts = {};
            if (currentTemplate) {
                currentTemplate.textAreas.forEach(area => {
                    const input = document.getElementById('text_' + area.id);
                    texts[area.id] = input ? input.value : area.placeholder;
                });
            }
            
            generatedMemes.push({
                id: Date.now(),
                template: currentTemplate?.name || 'Unknown',
                texts: texts,
                painScore: currentPainScore,
                timestamp: new Date(),
                dataUrl: canvas.toDataURL('image/png')
            });

            console.log('‚úÖ Meme generated successfully', generatedMemes.length, 'total memes');

            // Show success feedback - use proper button reference
            const generateButton = document.querySelector('button[onclick="generateMeme()"]');
            if (generateButton) {
                const originalText = generateButton.innerHTML;
                generateButton.innerHTML = '‚úÖ Generated!';
                generateButton.classList.add('!bg-green-600');
                setTimeout(() => {
                    generateButton.innerHTML = originalText;
                    generateButton.classList.remove('!bg-green-600');
                }, 2000);
            }
        }

        // Download meme
        function downloadMeme() {
            console.log('üíæ Download Meme button clicked');
            
            const canvas = document.getElementById('memeCanvas');
            if (!canvas) {
                console.error('‚ùå Canvas not found for download');
                alert('Canvas not found! Please try generating a meme first.');
                return;
            }
            
            if (!currentTemplate) {
                alert('Please select a template and generate a meme first!');
                return;
            }
            
            try {
                const link = document.createElement('a');
                link.download = `engineering-meme-${Date.now()}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                console.log('‚úÖ Meme download initiated');
                
                // Show download feedback
                const downloadButton = document.querySelector('button[onclick="downloadMeme()"]');
                if (downloadButton) {
                    const originalText = downloadButton.innerHTML;
                    downloadButton.innerHTML = 'üì• Downloaded!';
                    downloadButton.classList.add('!bg-green-600');
                    setTimeout(() => {
                        downloadButton.innerHTML = originalText;
                        downloadButton.classList.remove('!bg-green-600');
                    }, 2000);
                }
            } catch (error) {
                console.error('‚ùå Download failed:', error);
                alert('Download failed! Please try again.');
            }
        }

        // Copy meme to clipboard
        function copyToClipboard() {
            console.log('üìã Copy to Clipboard button clicked');
            
            const canvas = document.getElementById('memeCanvas');
            if (!canvas) {
                alert('Canvas not found! Please try generating a meme first.');
                return;
            }
            
            if (!currentTemplate) {
                alert('Please select a template and generate a meme first!');
                return;
            }
            
            try {
                canvas.toBlob(async (blob) => {
                    if (!blob) {
                        throw new Error('Failed to create blob from canvas');
                    }
                    
                    try {
                        await navigator.clipboard.write([
                            new ClipboardItem({ 'image/png': blob })
                        ]);
                        
                        console.log('‚úÖ Meme copied to clipboard');
                        
                        // Show copy feedback
                        const copyButton = document.querySelector('button[onclick="copyToClipboard()"]');
                        if (copyButton) {
                            const originalText = copyButton.innerHTML;
                            copyButton.innerHTML = '‚úÖ Copied!';
                            copyButton.classList.add('!bg-green-600');
                            setTimeout(() => {
                                copyButton.innerHTML = originalText;
                                copyButton.classList.remove('!bg-green-600');
                            }, 2000);
                        }
                    } catch (clipboardError) {
                        console.warn('Clipboard API failed, falling back to data URL copy');
                        // Fallback: copy the data URL to clipboard
                        const dataUrl = canvas.toDataURL('image/png');
                        await navigator.clipboard.writeText(dataUrl);
                        alert('Meme data copied to clipboard! You can paste it into image editors.');
                    }
                }, 'image/png');
            } catch (error) {
                console.error('‚ùå Copy to clipboard failed:', error);
                alert('Copy failed! Your browser might not support clipboard operations.');
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initApp);
        
        // Console info for engineers
        console.log('ü§ñ EngineerMemes.AI v2.0.0');
        console.log('Clean, functional meme generator');
        console.log('Pain Analysis: ‚úÖ | Templates: ‚úÖ | Canvas Rendering: ‚úÖ');
        console.log('Made with üòÖ by engineers, for engineers');
    </script>
</body>
</html>