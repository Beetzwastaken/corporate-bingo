<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corporate Suffering Suite - Making pain profitable</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        blue: {
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8'
                        }
                    },
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap');
        
        body { 
            font-family: 'Inter', 'system-ui', sans-serif; 
            background: linear-gradient(135deg, #1f2937 0%, #374151 50%, #1f2937 100%);
            min-height: 100vh;
            color: #f9fafb;
        }
        
        .pain-meter { 
            background: linear-gradient(to right, #10b981 0%, #f59e0b 50%, #ef4444 100%); 
        }
        
        .template-card {
            border: 2px solid #4b5563;
            transition: all 0.2s ease;
            background: rgba(31, 41, 55, 0.8);
            backdrop-filter: blur(10px);
        }
        
        .template-card:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
        }
        
        .template-card.selected {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.2);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.4);
        }
        
        .control-input {
            transition: all 0.2s ease;
            background: rgba(31, 41, 55, 0.9);
            border-color: #4b5563;
            color: #f9fafb;
        }
        
        .control-input:focus {
            border-color: #3b82f6;
            outline: none;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
            background: rgba(31, 41, 55, 1);
        }

        .control-input::placeholder {
            color: #9ca3af;
        }

        .glass-panel {
            background: rgba(31, 41, 55, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(75, 85, 99, 0.3);
        }

        .terminal-accent {
            font-family: 'JetBrains Mono', monospace;
            color: #10b981;
        }

        .engineering-grid {
            background-image: 
                linear-gradient(rgba(75, 85, 99, 0.3) 1px, transparent 1px),
                linear-gradient(90deg, rgba(75, 85, 99, 0.3) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .tool-tab {
            background: rgba(31, 41, 55, 0.6);
            border: 1px solid rgba(75, 85, 99, 0.3);
            color: #9ca3af;
        }

        .tool-tab:hover {
            background: rgba(31, 41, 55, 0.8);
            border-color: rgba(75, 85, 99, 0.5);
            color: #f9fafb;
        }

        .tool-tab.active {
            background: rgba(59, 130, 246, 0.2);
            border-color: #3b82f6;
            color: #3b82f6;
        }

        .tool-content {
            transition: all 0.3s ease;
        }

        .bingo-square {
            aspect-ratio: 1;
            background: rgba(55, 65, 81, 0.8);
            border: 1px solid #4b5563;
            color: #f9fafb;
            font-size: 0.7rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 2px;
            border-radius: 0.25rem;
            position: relative;
            min-height: 50px;
        }
        .bingo-square.compact {
            font-size: 0.6rem;
            padding: 1px;
            min-height: 40px;
        }
        .bingo-square.winning {
            animation: winFlash 1s ease-in-out 3;
            background: rgba(16, 185, 129, 0.4) !important;
            border-color: #10b981 !important;
        }
        @keyframes winFlash {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); box-shadow: 0 0 20px rgba(16, 185, 129, 0.6); }
        }

        .bingo-square:hover {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }

        .bingo-square.marked {
            background: rgba(59, 130, 246, 0.3);
            border-color: #3b82f6;
            color: #3b82f6;
        }

        .bingo-square.free {
            background: rgba(16, 185, 129, 0.3);
            border-color: #10b981;
            color: #10b981;
            cursor: not-allowed;
        }
        
        /* BINGO Modal */
        .bingo-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: modalFadeIn 0.3s ease-out;
        }
        .bingo-modal-content {
            background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
            border: 2px solid #10b981;
            border-radius: 1rem;
            padding: 2rem;
            text-align: center;
            max-width: 400px;
            animation: modalSlideIn 0.5s ease-out;
        }
        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes modalSlideIn {
            from { transform: translateY(-50px) scale(0.8); }
            to { transform: translateY(0) scale(1); }
        }
        
        /* Username Modal */
        .username-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1001;
        }
    </style>
</head>
<body>
    <!-- Navigation Header -->
    <header class="glass-panel border-b border-gray-600 engineering-grid">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-8">
                    <div>
                        <h1 class="text-2xl font-bold text-white">
                            <span class="terminal-accent">&gt;</span> Corporate Suffering Suite
                        </h1>
                        <p class="text-sm text-gray-300 terminal-accent">// Making pain profitable</p>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <nav class="flex items-center space-x-2">
                        <button onclick="switchTool('memes')" id="memesTab" class="tool-tab active flex items-center space-x-2 px-4 py-2 rounded-lg transition-all">
                            <span>üé≠</span>
                            <span class="hidden md:block">Meme Generator</span>
                        </button>
                        <button onclick="switchTool('bingo')" id="bingoTab" class="tool-tab flex items-center space-x-2 px-4 py-2 rounded-lg transition-all">
                            <span>üéØ</span>
                            <span class="hidden md:block">Buzzword Bingo</span>
                        </button>
                    </nav>
                    
                    <div class="text-right" id="statsDisplay">
                        <div class="text-lg font-semibold terminal-accent" id="painScore">5/10</div>
                        <div class="text-xs text-gray-400">Pain Level</div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 py-8">
        <!-- Meme Generator Tool -->
        <div id="memesTool" class="tool-content">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <!-- Left Column - Controls -->
            <div class="space-y-6">
                
                <!-- Pain Input -->
                <div class="glass-panel rounded-lg p-6">
                    <h2 class="text-lg font-semibold text-white mb-4"><span class="terminal-accent">&gt;</span> Describe your engineering pain</h2>
                    <textarea 
                        id="painInput" 
                        class="control-input w-full p-3 border border-gray-600 rounded-lg resize-none" 
                        rows="4" 
                        placeholder="e.g., Client wants to change the spec after we finished fabrication and testing..."
                        oninput="analyzePain(this.value)"
                    ></textarea>
                    <div class="mt-3 text-xs text-gray-400 terminal-accent" id="painMessage">Standard engineering suffering</div>
                </div>

                <!-- Template Selector -->
                <div class="glass-panel rounded-lg p-6">
                    <h2 class="text-lg font-semibold text-white mb-4"><span class="terminal-accent">&gt;</span> Choose template</h2>
                    <div class="grid grid-cols-2 gap-3" id="templates">
                        <!-- Templates will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Text Customization -->
                <div class="glass-panel rounded-lg p-6">
                    <h2 class="text-lg font-semibold text-white mb-4"><span class="terminal-accent">&gt;</span> Customize text</h2>
                    <div id="textInputs">
                        <div class="text-center py-8 text-gray-400">
                            <div class="text-2xl mb-2">üéØ</div>
                            <p class="text-sm">Select a template above to customize text</p>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Right Column - Preview -->
            <div class="space-y-6">
                
                <!-- Meme Preview -->
                <div class="glass-panel rounded-lg p-6">
                    <h2 class="text-lg font-semibold text-white mb-4"><span class="terminal-accent">&gt;</span> Preview</h2>
                    <div class="flex justify-center mb-4">
                        <canvas id="memeCanvas" width="400" height="400" class="border border-gray-600 rounded-lg bg-gray-800 max-w-full h-auto"></canvas>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="flex gap-3">
                        <button onclick="generateMeme()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                            <span class="terminal-accent">$</span> Generate Meme
                        </button>
                        <button onclick="downloadMeme()" class="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                            Download
                        </button>
                        <button onclick="copyToClipboard()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                            Copy
                        </button>
                    </div>
                </div>

            </div>
            
            </div>
        </div>

        <!-- Buzzword Bingo Tool -->
        <div id="bingoTool" class="tool-content" style="display: none;">
            <!-- Compact Header with Controls -->
            <div class="glass-panel rounded-lg p-4 mb-4">
                <div class="flex items-center justify-between flex-wrap gap-4">
                    <div class="flex items-center space-x-4">
                        <div>
                            <h1 class="text-xl font-bold text-white">
                                <span class="terminal-accent">&gt;</span> Buzzword Bingo
                            </h1>
                        </div>
                        <div class="text-sm text-gray-300">
                            <span class="terminal-accent" id="currentUser">Guest</span> | 
                            Games: <span id="gamesPlayed">0</span> | 
                            Wins: <span id="wins">0</span>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <select onchange="changeCardSize(this.value)" id="cardSizeSelect" class="control-input px-2 py-1 rounded text-xs">
                            <option value="5x5">5√ó5</option>
                            <option value="3x3">3√ó3</option>
                        </select>
                        <button onclick="regenerateCard()" class="bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded text-xs transition-colors">
                            üîÑ
                        </button>
                        <button onclick="generateBingoCard()" class="bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1 rounded text-xs transition-colors">
                            New Game
                        </button>
                    </div>
                </div>
            </div>

            <!-- Main Game Area -->
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-4">
                <!-- Bingo Card (Left Side) -->
                <div class="lg:col-span-2">
                    <div class="glass-panel rounded-lg p-4">
                        <div class="flex items-center justify-between mb-3">
                            <div class="text-sm text-gray-400">
                                Marked: <span id="markedCount" class="terminal-accent">1/25</span>
                            </div>
                            <div class="text-xs text-gray-500">Click squares when mentioned</div>
                        </div>

                        <!-- BINGO Header (Compact) -->
                        <div class="grid grid-cols-5 gap-1 mb-3" id="bingoHeader">
                            <div class="text-center py-1 bg-blue-600/20 border border-blue-500/30 rounded text-sm">
                                <span class="font-bold text-blue-300 terminal-accent">B</span>
                            </div>
                            <div class="text-center py-1 bg-blue-600/20 border border-blue-500/30 rounded text-sm">
                                <span class="font-bold text-blue-300 terminal-accent">I</span>
                            </div>
                            <div class="text-center py-1 bg-blue-600/20 border border-blue-500/30 rounded text-sm">
                                <span class="font-bold text-blue-300 terminal-accent">N</span>
                            </div>
                            <div class="text-center py-1 bg-blue-600/20 border border-blue-500/30 rounded text-sm">
                                <span class="font-bold text-blue-300 terminal-accent">G</span>
                            </div>
                            <div class="text-center py-1 bg-blue-600/20 border border-blue-500/30 rounded text-sm">
                                <span class="font-bold text-blue-300 terminal-accent">O</span>
                            </div>
                        </div>

                        <!-- Bingo Grid (Compact) -->
                        <div class="grid gap-1" id="bingoGrid">
                            <!-- Grid will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Room Management (Right Side) -->
                <div class="lg:col-span-2 space-y-4">
                    <!-- Current Room Status (Compact) -->
                    <div class="glass-panel rounded-lg p-4">
                        <h3 class="text-sm font-semibold text-white mb-2 flex items-center">
                            <span class="terminal-accent">&gt;</span>
                            <span class="ml-1">Room Status</span>
                        </h3>
                        <div id="roomStatus" class="text-sm">
                            <div class="text-gray-400">
                                <p>üè† <span class="terminal-accent">Solo Play</span></p>
                            </div>
                        </div>
                        <div id="roomParticipants" style="display: none;">
                            <div class="text-xs text-gray-300 mt-2">Participants:</div>
                            <div id="participantsList" class="text-xs space-y-1 mt-1">
                                <!-- Populated by JavaScript -->
                            </div>
                            <button onclick="leaveRoom()" class="w-full mt-2 bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded text-xs transition-colors">
                                Leave Room
                            </button>
                        </div>
                    </div>

                    <!-- Room Actions (Compact) -->
                    <div class="grid grid-cols-2 gap-3">
                        <!-- Create Room -->
                        <div class="glass-panel rounded-lg p-3">
                            <h4 class="text-xs font-semibold text-white mb-2">Create Room</h4>
                            <input type="text" id="roomName" placeholder="Meeting name" class="control-input w-full p-2 border border-gray-600 rounded text-xs mb-2" maxlength="30">
                            <button onclick="createRoom()" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white px-2 py-1 rounded text-xs transition-colors">
                                Create
                            </button>
                        </div>

                        <!-- Join Room -->
                        <div class="glass-panel rounded-lg p-3">
                            <h4 class="text-xs font-semibold text-white mb-2">Join Room</h4>
                            <input type="text" id="roomCode" placeholder="Room code" class="control-input w-full p-2 border border-gray-600 rounded text-xs mb-2 font-mono" maxlength="6">
                            <button onclick="joinRoom()" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded text-xs transition-colors">
                                Join
                            </button>
                        </div>
                    </div>

                    <!-- Quick Tips (Compact) -->
                    <div class="glass-panel rounded-lg p-3">
                        <h4 class="text-xs font-semibold text-white mb-2">Quick Tips</h4>
                        <div class="text-xs text-gray-400 space-y-1">
                            <p>‚Ä¢ Get 5 in a row (any direction) to win</p>
                            <p>‚Ä¢ Create/join rooms for group play</p>
                            <p>‚Ä¢ 3√ó3 cards for quick meetings</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Username Setup Modal -->
    <div id="usernameModal" class="username-modal" style="display: none;">
        <div class="bingo-modal-content">
            <h2 class="text-xl font-bold text-white mb-4">üëã Welcome to Corporate Suffering Suite!</h2>
            <p class="text-gray-300 mb-6">Enter your name to get started:</p>
            <input type="text" id="usernameInput" placeholder="Your name (e.g., John)" class="control-input w-full p-3 border border-gray-600 rounded-lg text-sm mb-4" maxlength="20">
            <button onclick="setUsername()" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-lg font-medium transition-colors">
                <span class="terminal-accent">$</span> Start Playing
            </button>
        </div>
    </div>

    <!-- BINGO Celebration Modal -->
    <div id="bingoModal" class="bingo-modal" style="display: none;">
        <div class="bingo-modal-content">
            <div class="text-6xl mb-4">üéâ</div>
            <h2 class="text-3xl font-bold text-green-400 mb-2 terminal-accent">BINGO!</h2>
            <p class="text-xl text-white mb-4">You survived another corporate meeting!</p>
            <div class="text-gray-300 mb-6" id="winDetails">
                <p>Winning pattern: <span class="terminal-accent" id="winPattern">Row</span></p>
                <p>Time: <span class="terminal-accent" id="gameTime">2:45</span></p>
            </div>
            <button onclick="closeBingoModal()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-bold transition-colors">
                üéØ Play Again
            </button>
        </div>
    </div>

    <script>
        // Engineering Meme Generator - Professional JavaScript Implementation
        
        let currentTemplate = null;
        let currentPainScore = 5;
        let generatedMemes = [];

        // Engineering-specific pain keywords and scoring
        const painKeywords = {
            high: ['deadline', 'urgent', 'asap', 'broken', 'failed', 'disaster', 'emergency', 'critical'],
            medium: ['change', 'modify', 'meeting', 'review', 'delay', 'client', 'scope'],
            low: ['working', 'progress', 'complete', 'success', 'fixed', 'approved']
        };

        // Meme templates with actual images and engineering themes
        const memeTemplates = [
            {
                id: 'drake',
                name: 'Drake Choice',
                category: 'general',
                imageUrl: 'https://i.imgflip.com/30b1gx.jpg',
                width: 400,
                height: 400,
                textAreas: [
                    { id: 'reject', placeholder: 'Following the spec', x: 75, y: 25, width: 40, fontSize: 20, color: 'black' },
                    { id: 'accept', placeholder: 'Client changes everything', x: 75, y: 75, width: 40, fontSize: 20, color: 'black' }
                ]
            },
            {
                id: 'this-is-fine',
                name: 'This is Fine',
                category: 'general',
                imageUrl: 'https://i.imgflip.com/26am.jpg',
                width: 400,
                height: 400,
                textAreas: [
                    { id: 'top', placeholder: 'Production is down', x: 50, y: 15, width: 80, fontSize: 24, color: 'white' },
                    { id: 'bottom', placeholder: 'This is fine', x: 50, y: 85, width: 80, fontSize: 20, color: 'black' }
                ]
            },
            {
                id: 'two-buttons',
                name: 'Two Buttons',
                category: 'general',
                imageUrl: 'https://i.imgflip.com/1g8my4.jpg',
                width: 400,
                height: 400,
                textAreas: [
                    { id: 'button1', placeholder: 'Fix the bug properly', x: 20, y: 35, width: 25, fontSize: 16, color: 'black' },
                    { id: 'button2', placeholder: 'Quick hotfix to prod', x: 80, y: 35, width: 25, fontSize: 16, color: 'black' }
                ]
            },
            {
                id: 'distracted',
                name: 'Distracted Boyfriend',
                category: 'software',
                imageUrl: 'https://i.imgflip.com/1ur9b0.jpg',
                width: 400,
                height: 400,
                textAreas: [
                    { id: 'girlfriend', placeholder: 'Current project', x: 15, y: 85, width: 20, fontSize: 14, color: 'white' },
                    { id: 'boyfriend', placeholder: 'Me', x: 45, y: 85, width: 15, fontSize: 14, color: 'white' },
                    { id: 'other_woman', placeholder: 'New framework', x: 80, y: 75, width: 25, fontSize: 14, color: 'white' }
                ]
            }
        ];

        // Initialize the app
        function initApp() {
            console.log('üöÄ Initializing EngineerMemes.AI...');
            
            // Verify all DOM elements exist
            const painInput = document.getElementById('painInput');
            const templates = document.getElementById('templates');
            const textInputs = document.getElementById('textInputs');
            const memeCanvas = document.getElementById('memeCanvas');
            
            console.log('DOM Elements Check:');
            console.log('- painInput:', painInput ? '‚úÖ' : '‚ùå');
            console.log('- templates:', templates ? '‚úÖ' : '‚ùå');
            console.log('- textInputs:', textInputs ? '‚úÖ' : '‚ùå');
            console.log('- memeCanvas:', memeCanvas ? '‚úÖ' : '‚ùå');
            
            renderTemplates();
            
            // Don't auto-select a template - let user choose
            renderTextInputs(); // This will show the "Select a Template" message
            updateCanvas(); // This will show empty canvas
            
            console.log('‚úÖ App initialized successfully');
            console.log('üìä Templates loaded:', memeTemplates.length);
        }

        // Analyze engineering pain level
        function analyzePain(input) {
            console.log('üîç Analyzing pain:', input.length > 0 ? 'Text provided' : 'Empty input');
            
            if (!input.trim()) {
                updatePainScore(5);
                return;
            }

            const lower = input.toLowerCase();
            let score = 5;
            let triggers = [];

            painKeywords.high.forEach(keyword => {
                if (lower.includes(keyword)) {
                    score += 2;
                    triggers.push(`+2 (${keyword})`);
                }
            });
            
            painKeywords.medium.forEach(keyword => {
                if (lower.includes(keyword)) {
                    score += 1;
                    triggers.push(`+1 (${keyword})`);
                }
            });
            
            painKeywords.low.forEach(keyword => {
                if (lower.includes(keyword)) {
                    score -= 1;
                    triggers.push(`-1 (${keyword})`);
                }
            });

            score = Math.max(1, Math.min(10, Math.round(score)));
            
            console.log('üìä Pain analysis result:');
            console.log('- Base score: 5');
            console.log('- Triggers:', triggers.length > 0 ? triggers.join(', ') : 'none');
            console.log('- Final score:', score);
            
            updatePainScore(score);
        }

        // Update pain score display
        function updatePainScore(score) {
            currentPainScore = score;
            const scoreElement = document.getElementById('painScore');
            const barElement = document.getElementById('painBar');
            const messageElement = document.getElementById('painMessage');

            scoreElement.textContent = score + '/10';
            barElement.style.width = (score * 10) + '%';

            const messages = {
                1: 'Mild engineering annoyance',
                2: 'Slight project turbulence',
                3: 'Minor technical hiccup', 
                4: 'Standard development friction',
                5: 'Typical engineering suffering',
                6: 'Elevated stress protocols',
                7: 'Approaching critical pain levels',
                8: 'High-stress engineering zone',
                9: 'MAXIMUM SUFFERING DETECTED',
                10: 'ENGINEERING EMERGENCY STATE'
            };

            messageElement.textContent = messages[score] || 'Unknown pain level';
        }

        // Render meme templates with image previews
        function renderTemplates() {
            const container = document.getElementById('templates');
            container.innerHTML = memeTemplates.map((template, index) => 
                `<div onclick="selectTemplate(${JSON.stringify(template).replace(/"/g, '&quot;')})" 
                      class="template-card cursor-pointer p-3 rounded-lg" id="template-${template.id}">
                    <div class="text-center">
                        <div class="w-full aspect-square bg-gray-700 rounded-lg mb-3 overflow-hidden">
                            <img src="${template.imageUrl}" 
                                 alt="${template.name}" 
                                 class="w-full h-full object-cover"
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'"
                                 loading="lazy">
                            <div class="w-full h-full bg-gray-600 rounded-lg items-center justify-center text-2xl hidden">
                                ${getTemplateIcon(template.category)}
                            </div>
                        </div>
                        <h4 class="text-sm font-medium text-white mb-1">${template.name}</h4>
                        <p class="text-xs text-gray-400">${template.textAreas.length} text field${template.textAreas.length === 1 ? '' : 's'}</p>
                    </div>
                </div>`
            ).join('');
        }

        // Get template icon
        function getTemplateIcon(category) {
            const icons = {
                general: 'üé≠',
                software: 'üíª', 
                mechanical: '‚öôÔ∏è',
                electrical: '‚ö°',
                civil: 'üèóÔ∏è',
                chemical: 'üß™'
            };
            return icons[category] || 'üéØ';
        }

        // Select a template
        function selectTemplate(template) {
            console.log('üéØ Template selected:', template.name);
            currentTemplate = template;
            
            // Update active template styling
            document.querySelectorAll('.template-card').forEach(el => {
                el.classList.remove('selected');
                el.classList.remove('border-blue-500');
                el.classList.add('border-gray-300');
            });
            
            const selectedCard = document.getElementById(`template-${template.id}`);
            if (selectedCard) {
                selectedCard.classList.add('selected');
                selectedCard.classList.remove('border-gray-300');
                selectedCard.classList.add('border-blue-500');
                console.log('‚úÖ Template card styling updated');
            } else {
                console.error('‚ùå Template card not found:', `template-${template.id}`);
            }
            
            // Render text inputs
            renderTextInputs();
            updateCanvas();
            console.log('‚úÖ Template selection complete');
        }

        // Render text input fields
        function renderTextInputs() {
            const container = document.getElementById('textInputs');
            if (!currentTemplate) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-400">
                        <div class="text-2xl mb-2">üéØ</div>
                        <p class="text-sm">Select a template above to customize text</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = currentTemplate.textAreas.map((area, index) => 
                `<div class="mb-4">
                    <label class="block text-sm font-medium text-gray-300 mb-2">
                        ${getAreaLabel(area.id)}
                    </label>
                    <input 
                        type="text" 
                        id="text_${area.id}"
                        placeholder="${area.placeholder}"
                        class="control-input w-full p-3 border border-gray-600 rounded-lg text-sm"
                        oninput="updateCanvas()"
                        maxlength="100"
                    />
                </div>`
            ).join('');
        }

        // Get area label
        function getAreaLabel(areaId) {
            const labels = {
                top: 'Top Text',
                bottom: 'Bottom Text', 
                reject: 'Reject/No',
                accept: 'Accept/Yes',
                button1: 'Button 1',
                button2: 'Button 2',
                girlfriend: 'Current Thing',
                boyfriend: 'Person',
                other_woman: 'New Thing'
            };
            return labels[areaId] || 'Text';
        }

        // Store loaded images to avoid reloading
        const imageCache = {};

        // Update canvas with real meme images
        function updateCanvas() {
            const canvas = document.getElementById('memeCanvas');
            const ctx = canvas.getContext('2d');
            
            // Clear canvas
            ctx.fillStyle = '#f8fafc';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw border
            ctx.strokeStyle = '#e2e8f0';
            ctx.lineWidth = 2;
            ctx.strokeRect(0, 0, canvas.width, canvas.height);

            if (!currentTemplate) {
                // Show placeholder when no template selected
                ctx.fillStyle = '#6b7280';
                ctx.font = '16px Inter';
                ctx.textAlign = 'center';
                ctx.fillText('Select a meme template to get started', canvas.width / 2, canvas.height / 2);
                return;
            }

            // Load and draw the meme image
            loadMemeImage(currentTemplate, (img) => {
                // Clear canvas again
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Draw the meme image
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                
                // Draw text overlays
                currentTemplate.textAreas.forEach(area => {
                    const input = document.getElementById('text_' + area.id);
                    const text = input ? input.value || area.placeholder : area.placeholder;
                    
                    if (!text) return;
                    
                    const x = (area.x / 100) * canvas.width;
                    const y = (area.y / 100) * canvas.height;
                    const maxWidth = (area.width / 100) * canvas.width;
                    
                    // Set text style based on template configuration
                    ctx.font = `bold ${area.fontSize}px Impact, Arial Black, sans-serif`;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    
                    // Draw text with outline for visibility
                    ctx.strokeStyle = area.color === 'white' ? '#000000' : '#ffffff';
                    ctx.lineWidth = 3;
                    ctx.fillStyle = area.color;
                    
                    // Word wrap for long text
                    const words = text.split(' ');
                    const lines = [];
                    let currentLine = '';
                    
                    words.forEach(word => {
                        const testLine = currentLine ? `${currentLine} ${word}` : word;
                        const metrics = ctx.measureText(testLine);
                        
                        if (metrics.width > maxWidth && currentLine) {
                            lines.push(currentLine);
                            currentLine = word;
                        } else {
                            currentLine = testLine;
                        }
                    });
                    if (currentLine) lines.push(currentLine);
                    
                    // Draw each line
                    const lineHeight = area.fontSize * 1.2;
                    const startY = y - ((lines.length - 1) * lineHeight) / 2;
                    
                    lines.forEach((line, index) => {
                        const lineY = startY + (index * lineHeight);
                        ctx.strokeText(line, x, lineY);
                        ctx.fillText(line, x, lineY);
                    });
                });

                // Add subtle pain level indicator
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.font = '12px Inter';
                ctx.textAlign = 'right';
                ctx.fillText(`Pain: ${currentPainScore}/10`, canvas.width - 10, canvas.height - 10);
            });
        }

        // Load meme image with caching
        function loadMemeImage(template, callback) {
            if (imageCache[template.id]) {
                callback(imageCache[template.id]);
                return;
            }
            
            const img = new Image();
            img.crossOrigin = 'anonymous'; // Handle CORS for external images
            
            img.onload = () => {
                imageCache[template.id] = img;
                callback(img);
            };
            
            img.onerror = () => {
                console.warn('Failed to load meme image:', template.imageUrl);
                // Fallback to colored rectangle with template name
                const canvas = document.getElementById('memeCanvas');
                const ctx = canvas.getContext('2d');
                
                ctx.fillStyle = '#e5e7eb';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#374151';
                ctx.font = 'bold 20px Inter';
                ctx.textAlign = 'center';
                ctx.fillText(template.name, canvas.width / 2, canvas.height / 2);
            };
            
            img.src = template.imageUrl;
        }

        // Generate meme (just update canvas for now)
        function generateMeme() {
            console.log('üéØ Generate Meme button clicked');
            
            if (!currentTemplate) {
                alert('Please select a template first!');
                return;
            }
            
            updateCanvas();
            
            // Add generation timestamp
            const canvas = document.getElementById('memeCanvas');
            if (!canvas) {
                console.error('‚ùå Canvas not found');
                return;
            }
            
            const ctx = canvas.getContext('2d');
            
            ctx.fillStyle = '#10b981';
            ctx.font = '10px Inter';
            ctx.textAlign = 'left';
            ctx.fillText(`Generated: ${new Date().toLocaleTimeString()}`, 10, canvas.height - 10);
            
            // Store in memory
            const texts = {};
            if (currentTemplate) {
                currentTemplate.textAreas.forEach(area => {
                    const input = document.getElementById('text_' + area.id);
                    texts[area.id] = input ? input.value : area.placeholder;
                });
            }
            
            generatedMemes.push({
                id: Date.now(),
                template: currentTemplate?.name || 'Unknown',
                texts: texts,
                painScore: currentPainScore,
                timestamp: new Date(),
                dataUrl: canvas.toDataURL('image/png')
            });

            console.log('‚úÖ Meme generated successfully', generatedMemes.length, 'total memes');

            // Show success feedback - use proper button reference
            const generateButton = document.querySelector('button[onclick="generateMeme()"]');
            if (generateButton) {
                const originalText = generateButton.innerHTML;
                generateButton.innerHTML = '‚úÖ Generated!';
                generateButton.classList.add('!bg-green-600');
                setTimeout(() => {
                    generateButton.innerHTML = originalText;
                    generateButton.classList.remove('!bg-green-600');
                }, 2000);
            }
        }

        // Download meme
        function downloadMeme() {
            console.log('üíæ Download Meme button clicked');
            
            const canvas = document.getElementById('memeCanvas');
            if (!canvas) {
                console.error('‚ùå Canvas not found for download');
                alert('Canvas not found! Please try generating a meme first.');
                return;
            }
            
            if (!currentTemplate) {
                alert('Please select a template and generate a meme first!');
                return;
            }
            
            try {
                const link = document.createElement('a');
                link.download = `engineering-meme-${Date.now()}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                console.log('‚úÖ Meme download initiated');
                
                // Show download feedback
                const downloadButton = document.querySelector('button[onclick="downloadMeme()"]');
                if (downloadButton) {
                    const originalText = downloadButton.innerHTML;
                    downloadButton.innerHTML = 'üì• Downloaded!';
                    downloadButton.classList.add('!bg-green-600');
                    setTimeout(() => {
                        downloadButton.innerHTML = originalText;
                        downloadButton.classList.remove('!bg-green-600');
                    }, 2000);
                }
            } catch (error) {
                console.error('‚ùå Download failed:', error);
                alert('Download failed! Please try again.');
            }
        }

        // Copy meme to clipboard
        function copyToClipboard() {
            console.log('üìã Copy to Clipboard button clicked');
            
            const canvas = document.getElementById('memeCanvas');
            if (!canvas) {
                alert('Canvas not found! Please try generating a meme first.');
                return;
            }
            
            if (!currentTemplate) {
                alert('Please select a template and generate a meme first!');
                return;
            }
            
            try {
                canvas.toBlob(async (blob) => {
                    if (!blob) {
                        throw new Error('Failed to create blob from canvas');
                    }
                    
                    try {
                        await navigator.clipboard.write([
                            new ClipboardItem({ 'image/png': blob })
                        ]);
                        
                        console.log('‚úÖ Meme copied to clipboard');
                        
                        // Show copy feedback
                        const copyButton = document.querySelector('button[onclick="copyToClipboard()"]');
                        if (copyButton) {
                            const originalText = copyButton.innerHTML;
                            copyButton.innerHTML = '‚úÖ Copied!';
                            copyButton.classList.add('!bg-green-600');
                            setTimeout(() => {
                                copyButton.innerHTML = originalText;
                                copyButton.classList.remove('!bg-green-600');
                            }, 2000);
                        }
                    } catch (clipboardError) {
                        console.warn('Clipboard API failed, falling back to data URL copy');
                        // Fallback: copy the data URL to clipboard
                        const dataUrl = canvas.toDataURL('image/png');
                        await navigator.clipboard.writeText(dataUrl);
                        alert('Meme data copied to clipboard! You can paste it into image editors.');
                    }
                }, 'image/png');
            } catch (error) {
                console.error('‚ùå Copy to clipboard failed:', error);
                alert('Copy failed! Your browser might not support clipboard operations.');
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initApp);
        
        // Console info for engineers
        console.log('ü§ñ Corporate Suffering Suite v2.0.0');
        console.log('Meme Generator: ‚úÖ | Bingo Game: ‚úÖ | Pain Analysis: ‚úÖ');
        console.log('Made with üòÖ by engineers, for engineers');

        // ===== MULTI-TOOL FUNCTIONALITY =====

        // Tool switching functionality
        function switchTool(toolName) {
            console.log('üîÑ Switching to tool:', toolName);
            
            // Hide all tools
            document.querySelectorAll('.tool-content').forEach(tool => {
                tool.style.display = 'none';
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tool-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tool
            const selectedTool = document.getElementById(toolName + 'Tool');
            const selectedTab = document.getElementById(toolName + 'Tab');
            
            if (selectedTool && selectedTab) {
                selectedTool.style.display = 'block';
                selectedTab.classList.add('active');
                
                // Initialize tool if needed
                if (toolName === 'bingo' && !bingoInitialized) {
                    initializeBingo();
                }
                
                // Update stats display
                updateStatsDisplay(toolName);
            }
        }

        function updateStatsDisplay(toolName) {
            const statsDisplay = document.getElementById('statsDisplay');
            const painScore = document.getElementById('painScore');
            
            if (toolName === 'memes') {
                painScore.style.display = 'block';
                painScore.textContent = currentPainScore + '/10';
                statsDisplay.querySelector('.text-xs').textContent = 'Pain Level';
            } else if (toolName === 'bingo') {
                const bingoStats = getBingoStats();
                painScore.textContent = bingoStats.gamesPlayed;
                painScore.style.display = 'block';
                statsDisplay.querySelector('.text-xs').textContent = 'Games Played';
            }
        }

        // ===== ENHANCED BINGO GAME FUNCTIONALITY =====

        let bingoInitialized = false;
        let bingoCard = [];
        let currentCardSize = '5x5';
        let gameStartTime = null;
        let currentRoom = null;
        let currentUser = 'Guest';
        let bingoStats = {
            gamesPlayed: 0,
            wins: 0,
            totalSquares: 0,
            winStreak: 0,
            bestTime: 0,
            averageTime: 0,
            favoritePatterns: {}
        };

        // Corporate buzzwords library
        const BUZZWORDS = [
            'Synergy', 'Leverage', 'Deep Dive', 'Circle Back', 'Touch Base',
            'Low-hanging Fruit', 'Move the Needle', 'Paradigm Shift', 'Think Outside the Box',
            'Best Practice', 'Core Competency', 'Value-add', 'Game Changer', 'Win-win',
            'Technical Debt', 'Scalability', 'Microservices', 'DevOps', 'Agile Transformation',
            'Digital Transformation', 'AI/ML Integration', 'Cloud Migration', 'API Gateway',
            'Actionable Items', 'Take it Offline', 'Ping Me', 'Loop In', 'Bandwidth',
            'On My Radar', 'Ideate', 'Stakeholder Buy-in', 'Scope Creep', 'Timeline',
            'KPI', 'ROI', 'Optimization', 'Streamline', 'Right-size', 'Iterate',
            'Pivot', 'Disrupt', 'Innovation', 'Growth Hacking', 'Metrics-driven',
            'Culture Fit', 'Team Player', 'Proactive', 'Own It', 'Drive Results',
            'Customer-centric', 'Data-driven', 'Results-oriented', 'Solution-focused'
        ];

        function initializeBingo() {
            console.log('üéØ Initializing Enhanced Bingo Game...');
            
            // Check for existing username
            const savedUser = localStorage.getItem('bingoUsername');
            if (!savedUser) {
                showUsernameModal();
                return;
            } else {
                currentUser = savedUser;
                document.getElementById('currentUser').textContent = currentUser;
            }
            
            // Load stats from localStorage
            const savedStats = localStorage.getItem('bingoStats');
            if (savedStats) {
                bingoStats = { ...bingoStats, ...JSON.parse(savedStats) };
            }
            
            // Load current room if exists
            const savedRoom = localStorage.getItem('currentRoom');
            if (savedRoom) {
                currentRoom = JSON.parse(savedRoom);
                updateRoomUI();
            }
            
            generateBingoCard();
            updateBingoUI();
            bingoInitialized = true;
            
            console.log('‚úÖ Enhanced Bingo game initialized');
        }

        function generateBingoCard() {
            console.log('üîÑ Generating new bingo card...', currentCardSize);
            gameStartTime = Date.now();
            
            const gridSize = currentCardSize === '3x3' ? 9 : 25;
            const freeSpaceIndex = currentCardSize === '3x3' ? 4 : 12;
            const numBuzzwords = currentCardSize === '3x3' ? 8 : 24;
            
            // Shuffle and select buzzwords 
            const shuffled = [...BUZZWORDS].sort(() => Math.random() - 0.5);
            const selected = shuffled.slice(0, numBuzzwords);
            
            bingoCard = [];
            
            // Generate squares
            for (let i = 0; i < gridSize; i++) {
                if (i === freeSpaceIndex) { // Center square (free space)
                    bingoCard.push({
                        id: i,
                        text: 'FREE SPACE',
                        isMarked: true,
                        isFree: true
                    });
                } else {
                    const textIndex = i < freeSpaceIndex ? i : i - 1;
                    bingoCard.push({
                        id: i,
                        text: selected[textIndex],
                        isMarked: false,
                        isFree: false
                    });
                }
            }
            
            renderBingoGrid();
            updateBingoUI();
            
            // Update game stats
            bingoStats.gamesPlayed++;
            saveBingoStats();
        }

        function renderBingoGrid() {
            const grid = document.getElementById('bingoGrid');
            const header = document.getElementById('bingoHeader');
            if (!grid) return;
            
            // Set grid layout based on card size
            const cols = currentCardSize === '3x3' ? 3 : 5;
            grid.className = `grid grid-cols-${cols} gap-1`;
            
            // Update BINGO header for card size
            if (header) {
                if (currentCardSize === '3x3') {
                    header.className = 'grid grid-cols-3 gap-1 mb-3';
                    header.innerHTML = `
                        <div class="text-center py-1 bg-blue-600/20 border border-blue-500/30 rounded text-sm">
                            <span class="font-bold text-blue-300 terminal-accent">B</span>
                        </div>
                        <div class="text-center py-1 bg-blue-600/20 border border-blue-500/30 rounded text-sm">
                            <span class="font-bold text-blue-300 terminal-accent">I</span>
                        </div>
                        <div class="text-center py-1 bg-blue-600/20 border border-blue-500/30 rounded text-sm">
                            <span class="font-bold text-blue-300 terminal-accent">G</span>
                        </div>
                    `;
                } else {
                    header.className = 'grid grid-cols-5 gap-1 mb-3';
                    header.innerHTML = `
                        <div class="text-center py-1 bg-blue-600/20 border border-blue-500/30 rounded text-sm">
                            <span class="font-bold text-blue-300 terminal-accent">B</span>
                        </div>
                        <div class="text-center py-1 bg-blue-600/20 border border-blue-500/30 rounded text-sm">
                            <span class="font-bold text-blue-300 terminal-accent">I</span>
                        </div>
                        <div class="text-center py-1 bg-blue-600/20 border border-blue-500/30 rounded text-sm">
                            <span class="font-bold text-blue-300 terminal-accent">N</span>
                        </div>
                        <div class="text-center py-1 bg-blue-600/20 border border-blue-500/30 rounded text-sm">
                            <span class="font-bold text-blue-300 terminal-accent">G</span>
                        </div>
                        <div class="text-center py-1 bg-blue-600/20 border border-blue-500/30 rounded text-sm">
                            <span class="font-bold text-blue-300 terminal-accent">O</span>
                        </div>
                    `;
                }
            }
            
            grid.innerHTML = bingoCard.map(square => `
                <div class="bingo-square ${square.isMarked ? 'marked' : ''} ${square.isFree ? 'free' : ''} ${currentCardSize === '3x3' ? 'compact' : ''}" 
                     onclick="${square.isFree ? '' : `toggleBingoSquare(${square.id})`}">
                    <span>${square.text}</span>
                    ${square.isMarked && !square.isFree ? '<div class="absolute top-1 right-1 text-xs">‚úì</div>' : ''}
                    ${square.isFree ? '<div class="absolute top-1 right-1 text-xs">‚òÖ</div>' : ''}
                </div>
            `).join('');
        }

        function toggleBingoSquare(squareId) {
            const square = bingoCard.find(s => s.id === squareId);
            if (!square || square.isFree) return;
            
            square.isMarked = !square.isMarked;
            bingoStats.totalSquares++;
            
            renderBingoGrid();
            updateBingoUI();
            saveBingoStats();
            
            // Check for automatic bingo
            const winResult = checkBingo();
            if (winResult) {
                triggerAutoBingo(winResult);
            }
        }

        function checkBingo() {
            const gridSize = currentCardSize === '3x3' ? 3 : 5;
            
            // Check rows
            for (let row = 0; row < gridSize; row++) {
                const rowStart = row * gridSize;
                const rowSquares = bingoCard.slice(rowStart, rowStart + gridSize);
                if (rowSquares.every(square => square.isMarked)) {
                    return {
                        type: 'row',
                        pattern: `Row ${row + 1}`,
                        winningSquares: rowSquares.map(s => s.id)
                    };
                }
            }
            
            // Check columns
            for (let col = 0; col < gridSize; col++) {
                const colSquares = bingoCard.filter((_, index) => index % gridSize === col);
                if (colSquares.every(square => square.isMarked)) {
                    return {
                        type: 'column',
                        pattern: `Column ${col + 1}`,
                        winningSquares: colSquares.map(s => s.id)
                    };
                }
            }
            
            // Check diagonals
            const diagonal1 = [];
            const diagonal2 = [];
            
            for (let i = 0; i < gridSize; i++) {
                diagonal1.push(bingoCard[i * gridSize + i]);
                diagonal2.push(bingoCard[i * gridSize + (gridSize - 1 - i)]);
            }
            
            if (diagonal1.every(square => square.isMarked)) {
                return {
                    type: 'diagonal',
                    pattern: 'Main Diagonal',
                    winningSquares: diagonal1.map(s => s.id)
                };
            }
            
            if (diagonal2.every(square => square.isMarked)) {
                return {
                    type: 'diagonal',
                    pattern: 'Anti Diagonal',
                    winningSquares: diagonal2.map(s => s.id)
                };
            }
            
            return null;
        }

        // Enhanced Bingo Functions
        
        function triggerAutoBingo(winResult) {
            console.log('üéâ AUTO-BINGO triggered!', winResult);
            
            // Highlight winning squares
            winResult.winningSquares.forEach(squareId => {
                const square = document.querySelector(`[onclick="toggleBingoSquare(${squareId})"]`);
                if (square) {
                    square.classList.add('winning');
                }
            });
            
            // Calculate game time
            const gameTime = Math.round((Date.now() - gameStartTime) / 1000);
            const timeString = `${Math.floor(gameTime / 60)}:${(gameTime % 60).toString().padStart(2, '0')}`;
            
            // Update stats
            bingoStats.wins++;
            bingoStats.winStreak++;
            if (bingoStats.bestTime === 0 || gameTime < bingoStats.bestTime) {
                bingoStats.bestTime = gameTime;
            }
            bingoStats.averageTime = Math.round((bingoStats.averageTime * (bingoStats.wins - 1) + gameTime) / bingoStats.wins);
            bingoStats.favoritePatterns[winResult.type] = (bingoStats.favoritePatterns[winResult.type] || 0) + 1;
            
            saveBingoStats();
            
            // Show celebration modal
            document.getElementById('winPattern').textContent = winResult.pattern;
            document.getElementById('gameTime').textContent = timeString;
            document.getElementById('bingoModal').style.display = 'flex';
            
            // Notify room if in multiplayer
            if (currentRoom) {
                broadcastBingo(winResult, timeString);
            }
        }
        
        function closeBingoModal() {
            document.getElementById('bingoModal').style.display = 'none';
            // Remove winning highlights
            document.querySelectorAll('.bingo-square.winning').forEach(square => {
                square.classList.remove('winning');
            });
            // Generate new card after short delay
            setTimeout(() => {
                generateBingoCard();
            }, 500);
        }
        
        function regenerateCard() {
            console.log('üîÑ Regenerating card (keeping stats)...');
            generateBingoCard(false); // Don't increment game count
            bingoStats.gamesPlayed--; // Adjust since generateBingoCard increments
            saveBingoStats();
        }
        
        function changeCardSize(newSize) {
            console.log('üìè Changing card size to:', newSize);
            currentCardSize = newSize;
            localStorage.setItem('cardSize', currentCardSize);
            generateBingoCard(false); // Don't increment game count
            bingoStats.gamesPlayed--; // Adjust since generateBingoCard increments
            saveBingoStats();
        }

        function updateBingoUI() {
            // Update marked count
            const markedCount = bingoCard.filter(s => s.isMarked).length;
            const totalSquares = bingoCard.length;
            const markedElement = document.getElementById('markedCount');
            if (markedElement) {
                markedElement.textContent = `${markedCount}/${totalSquares}`;
            }
            
            // Update stats
            const gamesElement = document.getElementById('gamesPlayed');
            const winsElement = document.getElementById('wins');
            const userElement = document.getElementById('currentUser');
            
            if (gamesElement) gamesElement.textContent = bingoStats.gamesPlayed;
            if (winsElement) winsElement.textContent = bingoStats.wins;
            if (userElement) userElement.textContent = currentUser;
        }

        function saveBingoStats() {
            localStorage.setItem('bingoStats', JSON.stringify(bingoStats));
        }

        function getBingoStats() {
            return bingoStats;
        }
        
        // Username Management
        function showUsernameModal() {
            document.getElementById('usernameModal').style.display = 'flex';
        }
        
        function setUsername() {
            const username = document.getElementById('usernameInput').value.trim();
            if (!username) {
                alert('Please enter a username');
                return;
            }
            
            currentUser = username;
            localStorage.setItem('bingoUsername', currentUser);
            document.getElementById('currentUser').textContent = currentUser;
            document.getElementById('usernameModal').style.display = 'none';
            
            // Now initialize the game
            const savedStats = localStorage.getItem('bingoStats');
            if (savedStats) {
                bingoStats = { ...bingoStats, ...JSON.parse(savedStats) };
            }
            
            generateBingoCard();
            updateBingoUI();
            bingoInitialized = true;
        }
        
        // Room Management Functions
        function createRoom() {
            const roomNameInput = document.getElementById('roomName');
            const roomName = roomNameInput.value.trim();
            
            if (!roomName) {
                alert('Please enter a room name');
                return;
            }
            
            const roomCode = Math.random().toString(36).substring(2, 8).toUpperCase();
            
            currentRoom = {
                code: roomCode,
                name: roomName,
                host: currentUser,
                participants: [currentUser],
                created: Date.now()
            };
            
            localStorage.setItem('currentRoom', JSON.stringify(currentRoom));
            updateRoomUI();
            roomNameInput.value = '';
            
            alert(`Room "${roomName}" created!\nRoom Code: ${roomCode}\nShare this code with colleagues.`);
            
            console.log('üè¢ Room created:', roomName, roomCode);
        }

        function joinRoom() {
            const roomCodeInput = document.getElementById('roomCode');
            const roomCode = roomCodeInput.value.trim().toUpperCase();
            
            if (!roomCode) {
                alert('Please enter a room code');
                return;
            }
            
            if (roomCode.length !== 6) {
                alert('Room code must be 6 characters');
                return;
            }
            
            // Simulate joining room (in real app, this would check server)
            const roomName = `Meeting Room ${roomCode}`;
            currentRoom = {
                code: roomCode,
                name: roomName,
                host: 'Unknown',
                participants: [currentUser, 'Alice', 'Bob'], // Simulated participants
                joined: Date.now()
            };
            
            localStorage.setItem('currentRoom', JSON.stringify(currentRoom));
            updateRoomUI();
            roomCodeInput.value = '';
            
            alert(`Joined room "${roomName}"! üéØ Good luck in your meeting!`);
            
            console.log('üö™ Joined room:', roomCode);
        }
        
        function leaveRoom() {
            if (!currentRoom) return;
            
            const roomName = currentRoom.name;
            currentRoom = null;
            localStorage.removeItem('currentRoom');
            updateRoomUI();
            
            alert(`Left room "${roomName}"`);
            console.log('üö™ Left room');
        }
        
        function updateRoomUI() {
            const roomStatusElement = document.getElementById('roomStatus');
            const roomParticipantsElement = document.getElementById('roomParticipants');
            const participantsListElement = document.getElementById('participantsList');
            
            if (currentRoom) {
                // Show room status (compact)
                roomStatusElement.innerHTML = `
                    <div class="text-gray-300 text-sm">
                        <p class="mb-1">üè† <span class="terminal-accent">${currentRoom.name}</span></p>
                        <p class="text-xs">Code: <span class="terminal-accent font-mono">${currentRoom.code}</span></p>
                        <p class="text-xs">${currentRoom.participants.length} participants</p>
                    </div>
                `;
                
                // Show participants list (compact)
                if (participantsListElement) {
                    participantsListElement.innerHTML = currentRoom.participants.map(participant => `
                        <div class="flex items-center justify-between text-xs">
                            <span class="text-gray-300">${participant}</span>
                            ${participant === currentRoom.host ? '<span class="text-yellow-400">üëë</span>' : ''}
                            ${participant === currentUser ? '<span class="text-green-400">You</span>' : ''}
                        </div>
                    `).join('');
                }
                
                if (roomParticipantsElement) {
                    roomParticipantsElement.style.display = 'block';
                }
            } else {
                // Show solo play status
                roomStatusElement.innerHTML = `
                    <div class="text-gray-400 text-sm">
                        <p>üè† <span class="terminal-accent">Solo Play</span></p>
                    </div>
                `;
                if (roomParticipantsElement) {
                    roomParticipantsElement.style.display = 'none';
                }
            }
        }
        
        function broadcastBingo(winResult, timeString) {
            // Simulate broadcasting bingo win to room participants
            console.log('üì¢ Broadcasting BINGO to room:', currentRoom.code, winResult);
            // In a real implementation, this would send to server/other players
        }
    </script>
</body>
</html>