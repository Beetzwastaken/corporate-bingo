import{d as J,p as Y,j as K,c as Z,a as e,u as V,s as _,b as Q}from"./index-C-v5SBQ6.js";import{c as ee,r as h}from"./store-D9DoIlTN.js";import"./vendor-gH-7aFTg.js";const se=r=>{const l=r==="single"?"MTG":"TEAM",s=Math.random().toString(36).substring(2,6).toUpperCase();return`${l}-${s}`},te=r=>r.roomType!=="single"||!r.expiresAt?!1:new Date>r.expiresAt,re=r=>{if(r.roomType==="persistent")return!1;const l=new Date(Date.now()-7200*1e3);return r.lastActivity<l},ae=ee()(J(Y((r,l)=>({rooms:{},activeRoomCode:null,currentPlayer:null,createRoom:async(s,o,t)=>{try{const a=se(t),i=await Z(s,o,t);if(!i.success||!i.data)return{success:!1,error:i.error||"Failed to create room"};const n=new Date,d={id:i.data.playerId,name:o,isHost:i.data.isHost,isConnected:!0,joinedAt:Date.now()},m={id:i.data.playerId,name:s,code:i.data.roomCode||a,players:[d],isActive:!0,createdAt:n,lastActivity:n,roomType:t,maxPlayers:10,expiresAt:t==="single"?new Date(n.getTime()+1440*60*1e3):void 0,cumulativeScores:t==="persistent"?{}:void 0,weeklyLeaderboard:t==="persistent"?[]:void 0,monthlyLeaderboard:t==="persistent"?[]:void 0},x={room:m,gameState:{board:[],markedSquares:Array(25).fill(!1),hasWon:!1,winningPattern:void 0},isActive:!0,lastSync:n};return r(p=>({rooms:{...p.rooms,[m.code]:x},activeRoomCode:m.code,currentPlayer:d})),{success:!0,roomCode:m.code}}catch(a){return console.error("Create room error:",a),{success:!1,error:a instanceof Error?a.message:"Failed to create room"}}},joinRoom:async(s,o)=>{try{const t=await K(s,o);if(!t.success||!t.data)return{success:!1,error:t.error||"Failed to join room"};const a=new Date,i={id:t.data.playerId,name:o,isHost:!1,isConnected:!0,joinedAt:Date.now()},n=s.startsWith("MTG-")?"single":"persistent",m={room:{id:s,name:t.data.roomName,code:s,players:[i],isActive:!0,createdAt:a,lastActivity:a,roomType:n,maxPlayers:10,expiresAt:n==="single"?new Date(a.getTime()+1440*60*1e3):void 0,cumulativeScores:n==="persistent"?{}:void 0,weeklyLeaderboard:n==="persistent"?[]:void 0,monthlyLeaderboard:n==="persistent"?[]:void 0},gameState:{board:[],markedSquares:Array(25).fill(!1),hasWon:!1,winningPattern:void 0},isActive:!0,lastSync:a};return r(x=>({rooms:{...x.rooms,[s]:m},activeRoomCode:s,currentPlayer:x.currentPlayer||i})),{success:!0}}catch(t){return console.error("Join room error:",t),{success:!1,error:t instanceof Error?t.message:"Failed to join room"}}},leaveRoom:s=>{r(o=>{const{[s]:t,...a}=o.rooms,i=o.activeRoomCode===s?Object.keys(a)[0]||null:o.activeRoomCode;return{rooms:a,activeRoomCode:i}})},leaveAllRooms:()=>{r({rooms:{},activeRoomCode:null})},setActiveRoom:s=>{const o=l();s&&o.rooms[s]?r({activeRoomCode:s}):r({activeRoomCode:null})},updateRoomState:(s,o)=>{r(t=>t.rooms[s]?{rooms:{...t.rooms,[s]:{...t.rooms[s],...o,room:{...t.rooms[s].room,...o.room||{},lastActivity:new Date}}}}:t)},updateRoomPlayers:(s,o)=>{r(t=>t.rooms[s]?{rooms:{...t.rooms,[s]:{...t.rooms[s],room:{...t.rooms[s].room,players:o,lastActivity:new Date}}}}:t)},updateGameState:(s,o)=>{r(t=>t.rooms[s]?{rooms:{...t.rooms,[s]:{...t.rooms[s],gameState:o,room:{...t.rooms[s].room,lastActivity:new Date}}}}:t)},updateCumulativeScores:(s,o,t)=>{r(a=>{if(!a.rooms[s]||a.rooms[s].room.roomType!=="persistent")return a;const i=a.rooms[s].room,n=i.cumulativeScores||{},d={...n,[o]:(n[o]||0)+t};return{rooms:{...a.rooms,[s]:{...a.rooms[s],room:{...i,cumulativeScores:d,lastActivity:new Date}}}}})},cleanupExpiredRooms:()=>{r(s=>{const o={};let t=s.activeRoomCode;return Object.entries(s.rooms).forEach(([a,i])=>{const{room:n}=i;!te(n)&&!re(n)?o[a]=i:t===a&&(t=null)}),!t&&Object.keys(o).length>0&&(t=Object.keys(o)[0]),{rooms:o,activeRoomCode:t}})},getRoomsOfType:s=>{const o=l();return Object.values(o.rooms).filter(t=>t.room.roomType===s)},getActiveRoom:()=>{const s=l();return s.activeRoomCode&&s.rooms[s.activeRoomCode]||null},setCurrentPlayer:s=>{r({currentPlayer:s})}}),{name:"multi-room-storage",partialize:r=>({rooms:r.rooms,activeRoomCode:r.activeRoomCode,currentPlayer:r.currentPlayer}),onRehydrateStorage:()=>r=>{r?.rooms&&Object.values(r.rooms).forEach(l=>{l.room.createdAt&&typeof l.room.createdAt=="string"&&(l.room.createdAt=new Date(l.room.createdAt)),l.room.lastActivity&&typeof l.room.lastActivity=="string"&&(l.room.lastActivity=new Date(l.room.lastActivity)),l.room.expiresAt&&typeof l.room.expiresAt=="string"&&(l.room.expiresAt=new Date(l.room.expiresAt)),l.lastSync&&typeof l.lastSync=="string"&&(l.lastSync=new Date(l.lastSync))})}})));function D({player:r,className:l="",size:s="medium"}){const[o,t]=h.useState([]),[a,i]=h.useState(r.currentScore||0);h.useEffect(()=>{const m=r.currentScore||0,x=m-a;if(x!==0&&a!==void 0){const p={id:Date.now().toString(),points:x,type:x>0?"positive":"negative",timestamp:Date.now()};t(v=>[...v,p]),setTimeout(()=>{t(v=>v.filter(w=>w.id!==p.id))},2e3)}i(m)},[r.currentScore,a]);const n={small:"text-sm",medium:"text-base",large:"text-lg"},d=r.currentScore||0;return e.jsxs("div",{className:`relative inline-flex items-center space-x-2 ${l}`,children:[e.jsx("div",{className:`font-semibold ${n[s]} ${d>0?"text-cyan-400":"text-apple-secondary"}`,children:d}),e.jsx("div",{className:"absolute left-full ml-2 pointer-events-none",children:o.map(m=>e.jsxs("div",{className:`absolute whitespace-nowrap font-bold text-sm ${m.type==="positive"?"text-cyan-400":"text-red-400"} animate-score-float`,style:{animation:"scoreFloat 2s ease-out forwards",top:`${(o.length-o.indexOf(m)-1)*20}px`},children:[m.type==="positive"?"+":"",m.points]},m.id))})]})}function ne({players:r,currentPlayerId:l,className:s="",compact:o=!1}){const t=h.useMemo(()=>[...r].sort((n,d)=>{const m=n.currentScore||0,x=d.currentScore||0;return m!==x?x-m:n.name.localeCompare(d.name)}),[r]),a=t.length>0&&t[0].currentScore||0,i=t.filter(n=>(n.currentScore||0)===a&&a>0);return r.length===0?e.jsxs("div",{className:`apple-panel p-4 ${s}`,children:[e.jsx("h3",{className:"text-sm font-medium text-apple-secondary mb-2",children:"Leaderboard"}),e.jsx("p",{className:"text-xs text-apple-tertiary",children:"No players yet"})]}):o?e.jsxs("div",{className:`space-y-2 ${s}`,children:[e.jsxs("h3",{className:"text-sm font-medium text-apple-secondary mb-2",children:["Leaderboard (",r.length,")"]}),e.jsxs("div",{className:"space-y-1",children:[t.slice(0,5).map((n,d)=>{const m=i.some(p=>p.id===n.id),x=n.id===l;return e.jsxs("div",{className:`flex items-center justify-between px-3 py-2 rounded-lg text-sm ${x?"bg-apple-accent/20 border border-apple-accent/30":"bg-apple-darkest"}`,children:[e.jsxs("div",{className:"flex items-center space-x-2 flex-1 min-w-0",children:[e.jsxs("span",{className:`text-xs font-medium w-6 text-center ${d<3?"text-yellow-400":"text-apple-secondary"}`,children:["#",d+1]}),m&&e.jsx("span",{className:"text-yellow-400 text-sm crown-animate",title:"Current Leader",children:"👑"}),e.jsx("span",{className:`font-medium truncate ${x?"text-apple-accent":"text-apple-text"}`,children:n.name}),x&&e.jsx("span",{className:"text-xs text-apple-accent",children:"(You)"})]}),e.jsx(D,{player:n,size:"small"})]},n.id)}),t.length>5&&e.jsxs("div",{className:"text-xs text-apple-tertiary text-center pt-1",children:["+",t.length-5," more players"]})]})]}):e.jsxs("div",{className:`apple-panel p-6 ${s}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-apple-text",children:"Leaderboard"}),e.jsxs("span",{className:"text-sm text-apple-secondary",children:[r.length," ",r.length===1?"Player":"Players"]})]}),e.jsx("div",{className:"space-y-3",children:t.map((n,d)=>{const m=i.some(p=>p.id===n.id),x=n.id===l;return e.jsxs("div",{className:`flex items-center justify-between p-4 rounded-lg transition-colors ${x?"bg-apple-accent/20 border border-apple-accent/30":"bg-apple-darkest hover:bg-apple-hover"}`,children:[e.jsxs("div",{className:"flex items-center space-x-4 flex-1 min-w-0",children:[e.jsx("div",{className:`flex items-center justify-center w-8 h-8 rounded-full font-bold text-sm ${d===0?"bg-yellow-500 text-black":d===1?"bg-gray-400 text-black":d===2?"bg-amber-600 text-black":"bg-apple-border text-apple-text"}`,children:d+1}),m&&e.jsx("div",{className:"flex items-center",children:e.jsx("span",{className:"text-xl crown-animate",title:"Current Leader",children:"👑"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`font-semibold truncate ${x?"text-apple-accent":"text-apple-text"}`,children:n.name}),n.isHost&&e.jsx("span",{className:"text-yellow-400 text-xs font-medium px-2 py-1 bg-yellow-900/20 rounded-full",children:"Host"}),x&&e.jsx("span",{className:"text-apple-accent text-xs font-medium px-2 py-1 bg-apple-accent/20 rounded-full",children:"You"})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${n.isConnected?"bg-green-400":"bg-red-400"}`}),e.jsx("span",{className:"text-xs text-apple-secondary",children:n.isConnected?"Online":"Offline"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{player:n,size:"large"}),e.jsx("span",{className:"text-xs text-apple-secondary",children:"pts"})]})]},n.id)})}),a>0&&e.jsxs("div",{className:"mt-6 pt-4 border-t border-apple-border",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-apple-secondary",children:[e.jsx("span",{children:"Game Progress"}),e.jsxs("span",{children:[a," points to lead"]})]}),e.jsx("div",{className:"mt-2 bg-apple-darker rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-cyan-500 to-cyan-400 transition-all duration-500",style:{width:`${Math.min(a/200*100,100)}%`}})})]})]})}const O=r=>r==="single"?"⏱️":"♾️",X=r=>r==="single"?"text-blue-400":"text-green-400",le=(r,l=12)=>r.length>l?`${r.substring(0,l)}...`:r;function oe({rooms:r,activeRoomCode:l,onRoomChange:s,onRoomClose:o}){const t=Object.entries(r);return t.length===0?null:t.length===1?e.jsx("div",{className:"border-b border-apple-border bg-apple-darkest",children:e.jsx("div",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`text-sm ${X(t[0][1].room.roomType)}`,children:O(t[0][1].room.roomType)}),e.jsx("span",{className:"text-sm font-medium text-apple-text",children:t[0][1].room.name}),e.jsx("span",{className:"text-xs text-apple-secondary font-mono bg-apple-darkest px-2 py-1 rounded",children:t[0][1].room.code})]})})}):e.jsxs("div",{className:"border-b border-apple-border bg-apple-darkest",children:[e.jsxs("div",{className:"flex overflow-x-auto scrollbar-hide",children:[t.map(([a,i])=>{const n=l===a,{room:d}=i;return e.jsxs("div",{className:`
                group relative flex items-center space-x-2 px-4 py-3 cursor-pointer
                border-b-2 transition-all duration-200 flex-shrink-0 min-w-0
                ${n?"border-apple-accent bg-apple-accent/5":"border-transparent hover:bg-apple-darkest/80"}
              `,onClick:()=>s(a),children:[e.jsx("span",{className:`text-sm flex-shrink-0 ${X(d.roomType)}`,children:O(d.roomType)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:`text-sm font-medium truncate ${n?"text-apple-accent":"text-apple-text"}`,children:[e.jsx("span",{className:"hidden sm:inline",children:d.name}),e.jsx("span",{className:"sm:hidden",children:le(d.name)})]}),e.jsx("span",{className:`text-xs font-mono px-2 py-1 rounded flex-shrink-0 ${n?"bg-apple-accent/20 text-apple-accent":"bg-apple-darkest text-apple-secondary"}`,children:d.code})]}),e.jsxs("div",{className:"flex items-center space-x-1 mt-1",children:[e.jsx("div",{className:`w-1 h-1 rounded-full ${d.players.some(m=>m.isConnected)?"bg-green-400":"bg-apple-secondary"}`}),e.jsxs("span",{className:"text-xs text-apple-secondary",children:[d.players.length," player",d.players.length!==1?"s":""]})]})]}),e.jsx("button",{onClick:m=>{m.stopPropagation(),o(a)},className:`
                  w-5 h-5 rounded-full flex items-center justify-center flex-shrink-0
                  transition-all duration-200 opacity-0 group-hover:opacity-100
                  hover:bg-red-500/20 hover:text-red-400
                  ${n?"opacity-100":""}
                `,title:"Leave room",children:e.jsx("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})}),n&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-apple-accent"})]},a)}),e.jsx("div",{className:"flex-shrink-0 border-l border-apple-border/50",children:e.jsxs("button",{className:`
              h-full px-4 py-3 text-apple-secondary hover:text-apple-accent
              hover:bg-apple-darkest/80 transition-all duration-200
              flex items-center space-x-2
            `,title:"Create or join another room",onClick:()=>{},children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),e.jsx("span",{className:"text-sm font-medium hidden lg:inline",children:"Add Room"})]})})]}),e.jsx("div",{className:"sm:hidden flex justify-center py-1",children:e.jsx("div",{className:"flex space-x-1",children:t.map(([a])=>e.jsx("div",{className:`w-1 h-1 rounded-full transition-colors ${l===a?"bg-apple-accent":"bg-apple-border"}`},a))})})]})}function ce({selectedType:r,onTypeChange:l,disabled:s=!1,compact:o}){const[t,a]=h.useState(!1);return h.useEffect(()=>{if(o!==void 0){a(o);return}const i=()=>{a(window.innerWidth>=768)};return i(),window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[o]),t?e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-apple-secondary",children:"Room Type"}),e.jsxs("div",{className:`
          flex rounded-lg border border-apple-border bg-apple-darkest overflow-hidden
          ${s?"opacity-50 cursor-not-allowed":""}
        `,children:[e.jsxs("button",{onClick:()=>!s&&l("single"),disabled:s,className:`
              room-type-compact-button flex-1 flex items-center justify-center px-3 py-2.5 text-sm font-medium 
              transition-all duration-200 relative overflow-hidden
              ${r==="single"?"text-white room-type-selected-gradient shadow-sm":"text-apple-secondary hover:text-apple-text hover:bg-apple-hover"}
              ${s?"cursor-not-allowed opacity-50":"cursor-pointer"}
            `,children:[e.jsx("span",{className:"text-base mr-2",children:"⏱️"}),"Meeting"]}),e.jsxs("button",{onClick:()=>!s&&l("persistent"),disabled:s,className:`
              room-type-compact-button flex-1 flex items-center justify-center px-3 py-2.5 text-sm font-medium 
              transition-all duration-200 relative overflow-hidden border-l border-apple-border
              ${r==="persistent"?"text-white room-type-selected-gradient shadow-sm":"text-apple-secondary hover:text-apple-text hover:bg-apple-hover"}
              ${s?"cursor-not-allowed opacity-50":"cursor-pointer"}
            `,children:[e.jsx("span",{className:"text-base mr-2",children:"♾️"}),"Team"]})]}),e.jsx("p",{className:"text-xs text-apple-secondary leading-relaxed",children:r==="single"?"One-time meeting room that auto-expires after 24 hours":"Persistent team room with cumulative scoring and leaderboards"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-apple-secondary mb-2",children:"Room Type"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:`
            relative p-4 rounded-lg border cursor-pointer transition-all duration-200
            ${r==="single"?"border-cyan-500 bg-cyan-500/10":"border-apple-border bg-apple-darkest hover:bg-apple-darkest/80"}
            ${s?"opacity-50 cursor-not-allowed":""}
          `,onClick:()=>!s&&l("single"),children:[e.jsx("div",{className:`
            absolute top-3 right-3 w-4 h-4 rounded-full border-2 transition-all
            ${r==="single"?"border-cyan-500 bg-cyan-500":"border-apple-border bg-transparent"}
          `,children:r==="single"&&e.jsx("div",{className:"w-full h-full rounded-full bg-white scale-50 transform"})}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500/20 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-lg",children:"⏱️"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-apple-text text-sm mb-1",children:"Single Meeting"}),e.jsx("p",{className:"text-xs text-apple-secondary leading-relaxed",children:"One-time use for specific meetings. Auto-expires after 24 hours or 2 hours of inactivity."}),e.jsxs("div",{className:"mt-2 flex items-center space-x-2 text-xs text-apple-secondary",children:[e.jsx("span",{className:"px-2 py-1 bg-blue-500/20 rounded text-blue-400 font-mono",children:"MTG-XXXX"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:"Perfect for one-off meetings"})]})]})]})]}),e.jsxs("div",{className:`
            relative p-4 rounded-lg border cursor-pointer transition-all duration-200
            ${r==="persistent"?"border-cyan-500 bg-cyan-500/10":"border-apple-border bg-apple-darkest hover:bg-apple-darkest/80"}
            ${s?"opacity-50 cursor-not-allowed":""}
          `,onClick:()=>!s&&l("persistent"),children:[e.jsx("div",{className:`
            absolute top-3 right-3 w-4 h-4 rounded-full border-2 transition-all
            ${r==="persistent"?"border-cyan-500 bg-cyan-500":"border-apple-border bg-transparent"}
          `,children:r==="persistent"&&e.jsx("div",{className:"w-full h-full rounded-full bg-white scale-50 transform"})}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-500/20 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-lg",children:"♾️"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-apple-text text-sm mb-1",children:"Persistent Team"}),e.jsx("p",{className:"text-xs text-apple-secondary leading-relaxed",children:"Long-running room for teams. Maintains cumulative scores and leaderboards over time."}),e.jsxs("div",{className:"mt-2 flex items-center space-x-2 text-xs text-apple-secondary",children:[e.jsx("span",{className:"px-2 py-1 bg-green-500/20 rounded text-green-400 font-mono",children:"TEAM-XXXX"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:"Never expires"})]})]})]})]})]}),e.jsx("div",{className:"mt-3 p-3 bg-apple-darkest/50 rounded-lg",children:r==="single"?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-xs",children:[e.jsx("span",{className:"w-1 h-1 bg-blue-400 rounded-full"}),e.jsx("span",{className:"text-apple-secondary",children:"Room automatically expires after 24 hours or 2 hours of inactivity"})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-xs",children:[e.jsx("span",{className:"w-1 h-1 bg-blue-400 rounded-full"}),e.jsx("span",{className:"text-apple-secondary",children:"Perfect for one-time meetings, workshops, or events"})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-xs",children:[e.jsx("span",{className:"w-1 h-1 bg-blue-400 rounded-full"}),e.jsx("span",{className:"text-apple-secondary",children:"Scores reset with each new game session"})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-xs",children:[e.jsx("span",{className:"w-1 h-1 bg-green-400 rounded-full"}),e.jsx("span",{className:"text-apple-secondary",children:"Room persists indefinitely with cumulative scoring"})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-xs",children:[e.jsx("span",{className:"w-1 h-1 bg-green-400 rounded-full"}),e.jsx("span",{className:"text-apple-secondary",children:"Weekly and monthly leaderboards track long-term performance"})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-xs",children:[e.jsx("span",{className:"w-1 h-1 bg-green-400 rounded-full"}),e.jsx("span",{className:"text-apple-secondary",children:"Ideal for teams, departments, or ongoing groups"})]})]})})]})}function xe(){const[r,l]=h.useState(""),[s,o]=h.useState(""),[t,a]=h.useState(""),[i,n]=h.useState("single"),[d,m]=h.useState(!1),[x,p]=h.useState(""),[v,w]=h.useState({}),{playerName:j,isConnecting:b,isConnected:R,connectionError:A,setPlayerName:G}=V(),{rooms:C,activeRoomCode:k,currentPlayer:g,createRoom:B,joinRoom:H,leaveRoom:S,setActiveRoom:I,getActiveRoom:z,cleanupExpiredRooms:$}=ae(),u=z()?.room||null,y=Object.keys(C).length>0;h.useEffect(()=>{!t&&j&&a(j)},[j,t]),h.useEffect(()=>{const c=setInterval(()=>{$()},3e5);return()=>clearInterval(c)},[$]),h.useEffect(()=>{if(!u?.players)return;u.players.forEach(f=>{const W=f.currentScore||0,T=v[f.id]||0,N=W-T;if(N!==0&&T!==void 0&&v[f.id]!==void 0)if(f.id===g?.id){const U=F(N);_(N,U)}else N>0&&Q(`${f.name} scored ${N} points!`,void 0,"success")});const c={};u.players.forEach(f=>{c[f.id]=f.currentScore||0}),w(c)},[u?.players,g?.id,v]);const F=c=>c===10?"Square verified!":c===50?"3-in-a-row bonus!":c===100?"4-in-a-row bonus!":c===200?"BINGO achieved!":c===-50?"Self-claim penalty":c>0?`+${c} points earned`:`${c} points penalty`,q=c=>{const f=c.trim().toUpperCase();return/^[A-Z0-9]{6}$/.test(f)||/^(MTG|TEAM)-[A-Z0-9]{4}$/.test(f)},P=()=>{const c=t.trim();c.length>=2&&c.length<=30?(G(c),p("")):p("Name must be 2-30 characters")},L=async()=>{if(!r.trim()){p("Room name is required");return}if(!j){p("Set your name first");return}p("");const c=await B(r.trim(),j,i);c.success?(l(""),m(!1)):p(c.error||"Could not create room")},E=async()=>{if(!s.trim()){p("Room code is required");return}if(!q(s)){p("Code must be 6 characters or MTG-/TEAM- format");return}if(!j){p("Set your name first");return}p("");const c=await H(s.toUpperCase(),j);c.success?o(""):p(c.error||"Could not join room")},M=c=>{c?S(c):k&&S(k),p("")};return e.jsxs("div",{className:"flex flex-col h-full",children:[y&&e.jsx(oe,{rooms:C,activeRoomCode:k,onRoomChange:I,onRoomClose:M}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[(x||A)&&e.jsx("div",{className:"bg-red-900/20 border border-red-500/30 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-red-500"}),e.jsx("p",{className:"text-red-300 text-sm font-medium",children:x||A})]})}),!j&&e.jsxs("div",{className:"apple-panel p-4 bg-yellow-900/10 border-yellow-500/30",children:[e.jsx("h2",{className:"text-lg font-semibold text-apple-text mb-2",children:"Player Setup"}),e.jsx("p",{className:"text-apple-secondary text-sm mb-3",children:"Set your name to continue"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"text",value:t,onChange:c=>a(c.target.value),className:"apple-input w-full",placeholder:"Your name",maxLength:30,onKeyPress:c=>c.key==="Enter"&&P()}),e.jsx("button",{onClick:P,disabled:!t.trim()||b,className:"apple-button w-full justify-center",children:"Set Name"})]})]}),u&&e.jsxs("div",{className:"apple-panel p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`text-base ${u.roomType==="single"?"text-blue-400":"text-green-400"}`,children:u.roomType==="single"?"⏱️":"♾️"}),e.jsx("h2",{className:"text-base font-semibold text-apple-text",children:"Current Room"}),e.jsx("span",{className:`px-2 py-0.5 text-xs rounded font-medium ${u.roomType==="single"?"bg-blue-500/20 text-blue-400":"bg-green-500/20 text-green-400"}`,children:u.roomType==="single"?"Meeting":"Team"})]}),e.jsx("button",{onClick:()=>M(),disabled:b,className:"px-3 py-1.5 bg-red-600 hover:bg-red-700 disabled:bg-apple-darkest disabled:cursor-not-allowed text-white rounded-md font-medium transition-colors text-xs",children:"Leave"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-apple-accent font-medium text-base",children:u.name}),u.roomType==="single"&&u.expiresAt&&e.jsxs("p",{className:"text-xs text-apple-secondary mt-0.5",children:["Expires: ",new Date(u.expiresAt).toLocaleDateString()," at"," ",new Date(u.expiresAt).toLocaleTimeString()]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsx("div",{className:"col-span-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-apple-secondary",children:"Room Code"}),e.jsx("span",{className:"font-mono text-apple-accent bg-apple-darkest px-2 py-0.5 rounded text-sm",children:u.code})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-apple-secondary text-xs",children:"Players"}),e.jsxs("span",{className:"text-apple-text text-xs",children:[u.players.length,"/",u.maxPlayers||10]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-apple-secondary text-xs",children:"Status"}),e.jsxs("div",{className:`flex items-center space-x-1 ${R?"text-green-400":"text-red-400"}`,children:[e.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${R?"bg-green-400":"bg-red-400"}`}),e.jsx("span",{className:"text-xs",children:R?"Connected":"Offline"})]})]}),e.jsxs("div",{className:"col-span-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-apple-secondary text-xs",children:"Your Name"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"text-apple-text text-xs",children:g?.name}),g?.isHost&&e.jsx("span",{className:"text-yellow-400 text-xs",children:"(Host)"})]})]})]}),e.jsx("div",{className:"mt-4 pt-3 border-t border-apple-border",children:e.jsx(ne,{players:u.players,currentPlayerId:g?.id,compact:!0})})]}),(!y||d)&&j&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"apple-panel p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-base font-semibold text-apple-text",children:"Create Room"}),y&&e.jsx("button",{onClick:()=>m(!1),className:"text-apple-secondary hover:text-apple-text transition-colors",children:e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(ce,{selectedType:i,onTypeChange:n,disabled:b,compact:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-apple-secondary mb-2",children:"Room Name"}),e.jsx("input",{type:"text",value:r,onChange:c=>l(c.target.value),className:"apple-input w-full",placeholder:i==="single"?"Meeting name":"Team name",maxLength:50,disabled:b,onKeyPress:c=>c.key==="Enter"&&L()})]}),e.jsx("button",{onClick:L,disabled:!r.trim()||b,className:"apple-button w-full justify-center bg-emerald-600 hover:bg-emerald-700",children:`Create ${i==="single"?"Meeting":"Team"} Room`})]})]}),e.jsxs("div",{className:"apple-panel p-4",children:[e.jsx("h2",{className:"text-base font-semibold text-apple-text mb-3",children:"Join Room"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-apple-secondary mb-2",children:"Room Code"}),e.jsx("input",{type:"text",value:s,onChange:c=>o(c.target.value.toUpperCase()),className:"apple-input w-full text-center font-mono tracking-wider",placeholder:"MTG-A1B2 or TEAM-C3D4",maxLength:9,disabled:b,onKeyPress:c=>c.key==="Enter"&&E()}),e.jsx("p",{className:"text-xs text-apple-secondary mt-1",children:"Enter a meeting code (MTG-XXXX) or team code (TEAM-XXXX)"})]}),e.jsx("button",{onClick:E,disabled:!s.trim()||b,className:"apple-button w-full justify-center",children:"Join Room"})]})]})]}),y&&!d&&j&&e.jsx("div",{className:"apple-panel p-4",children:e.jsxs("button",{onClick:()=>m(!0),className:"apple-button w-full justify-center bg-emerald-600 hover:bg-emerald-700",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Create Another Room"]})}),!y&&e.jsxs("div",{className:"apple-panel p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-apple-text mb-4",children:"Game Features"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-apple-accent/20 rounded-full flex items-center justify-center mx-auto mb-2",children:e.jsx("span",{className:"text-xl",children:"🎯"})}),e.jsx("h3",{className:"font-medium text-apple-text text-sm mb-1",children:"Unique Boards"}),e.jsx("p",{className:"text-xs text-apple-secondary",children:"Unique cards for each player"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-apple-accent/20 rounded-full flex items-center justify-center mx-auto mb-2",children:e.jsx("span",{className:"text-xl",children:"⚡"})}),e.jsx("h3",{className:"font-medium text-apple-text text-sm mb-1",children:"Real-time"}),e.jsx("p",{className:"text-xs text-apple-secondary",children:"Instant synchronization"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-apple-accent/20 rounded-full flex items-center justify-center mx-auto mb-2",children:e.jsx("span",{className:"text-xl",children:"⏱️"})}),e.jsx("h3",{className:"font-medium text-apple-text text-sm mb-1",children:"Meeting Rooms"}),e.jsx("p",{className:"text-xs text-apple-secondary",children:"Auto-expire after meetings"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-apple-accent/20 rounded-full flex items-center justify-center mx-auto mb-2",children:e.jsx("span",{className:"text-xl",children:"♾️"})}),e.jsx("h3",{className:"font-medium text-apple-text text-sm mb-1",children:"Team Rooms"}),e.jsx("p",{className:"text-xs text-apple-secondary",children:"Persistent with leaderboards"})]})]})]})]})]})}export{xe as RoomManager};
