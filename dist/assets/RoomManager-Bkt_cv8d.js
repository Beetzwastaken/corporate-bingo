import{d as K,p as Y,j as Z,c as V,a as e,u as X,s as _,b as Q}from"./index-C4g4uNwA.js";import{c as ee,r as f}from"./store-D9DoIlTN.js";import"./vendor-gH-7aFTg.js";const se=()=>Math.random().toString(36).substring(2,6).toUpperCase(),te=r=>r.roomType!=="single"||!r.expiresAt?!1:new Date>r.expiresAt,re=r=>{if(r.roomType==="persistent")return!1;const o=new Date(Date.now()-7200*1e3);return r.lastActivity<o},ae=ee()(K(Y((r,o)=>({rooms:{},activeRoomCode:null,currentPlayer:null,createRoom:async(s,l,t)=>{try{const a=se(),d=await V(s,l,t);if(!d.success||!d.data)return{success:!1,error:d.error||"Failed to create room"};const n=new Date,i={id:d.data.playerId,name:l,isHost:d.data.isHost,isConnected:!0,joinedAt:Date.now()},m={id:d.data.playerId,name:s,code:d.data.roomCode||a,players:[i],isActive:!0,createdAt:n,lastActivity:n,roomType:t,maxPlayers:10,expiresAt:t==="single"?new Date(n.getTime()+1440*60*1e3):void 0,cumulativeScores:t==="persistent"?{}:void 0,weeklyLeaderboard:t==="persistent"?[]:void 0,monthlyLeaderboard:t==="persistent"?[]:void 0},p={room:m,gameState:{board:[],markedSquares:Array(25).fill(!1),hasWon:!1,winningPattern:void 0,appliedBonuses:new Map},isActive:!0,lastSync:n};return r(x=>({rooms:{...x.rooms,[m.code]:p},activeRoomCode:m.code,currentPlayer:i})),{success:!0,roomCode:m.code}}catch(a){return console.error("Create room error:",a),{success:!1,error:a instanceof Error?a.message:"Failed to create room"}}},joinRoom:async(s,l)=>{try{const t=await Z(s,l);if(!t.success||!t.data)return{success:!1,error:t.error||"Failed to join room"};const a=new Date,d={id:t.data.playerId,name:l,isHost:!1,isConnected:!0,joinedAt:Date.now()},n=t.data.room,i=n?.type==="persistent"?"persistent":"single",m=Array.isArray(n?.players)?n.players.map(h=>({id:h.id,name:h.name,isHost:h.isHost||!1,isConnected:!0,joinedAt:h.joinedAt?new Date(h.joinedAt).getTime():Date.now(),currentScore:h.score||0})):[d],x={room:{id:s,name:t.data.roomName||n?.name||s,code:s,players:m,isActive:!0,createdAt:n?.createdAt?new Date(n.createdAt):a,lastActivity:a,roomType:i,maxPlayers:10,expiresAt:i==="single"?new Date(a.getTime()+1440*60*1e3):void 0,cumulativeScores:i==="persistent"?{}:void 0,weeklyLeaderboard:i==="persistent"?[]:void 0,monthlyLeaderboard:i==="persistent"?[]:void 0},gameState:{board:[],markedSquares:Array(25).fill(!1),hasWon:!1,winningPattern:void 0,appliedBonuses:new Map},isActive:!0,lastSync:a};return r(h=>({rooms:{...h.rooms,[s]:x},activeRoomCode:s,currentPlayer:h.currentPlayer||d})),{success:!0}}catch(t){return console.error("Join room error:",t),{success:!1,error:t instanceof Error?t.message:"Failed to join room"}}},leaveRoom:s=>{r(l=>{const{[s]:t,...a}=l.rooms,d=l.activeRoomCode===s?Object.keys(a)[0]||null:l.activeRoomCode;return{rooms:a,activeRoomCode:d}})},leaveAllRooms:()=>{r({rooms:{},activeRoomCode:null})},setActiveRoom:s=>{const l=o();s&&l.rooms[s]?r({activeRoomCode:s}):r({activeRoomCode:null})},updateRoomState:(s,l)=>{r(t=>t.rooms[s]?{rooms:{...t.rooms,[s]:{...t.rooms[s],...l,room:{...t.rooms[s].room,...l.room||{},lastActivity:new Date}}}}:t)},updateRoomPlayers:(s,l)=>{r(t=>t.rooms[s]?{rooms:{...t.rooms,[s]:{...t.rooms[s],room:{...t.rooms[s].room,players:l,lastActivity:new Date}}}}:t)},updateGameState:(s,l)=>{r(t=>t.rooms[s]?{rooms:{...t.rooms,[s]:{...t.rooms[s],gameState:l,room:{...t.rooms[s].room,lastActivity:new Date}}}}:t)},updateCumulativeScores:(s,l,t)=>{r(a=>{if(!a.rooms[s]||a.rooms[s].room.roomType!=="persistent")return a;const d=a.rooms[s].room,n=d.cumulativeScores||{},i={...n,[l]:(n[l]||0)+t};return{rooms:{...a.rooms,[s]:{...a.rooms[s],room:{...d,cumulativeScores:i,lastActivity:new Date}}}}})},cleanupExpiredRooms:()=>{r(s=>{const l={};let t=s.activeRoomCode;return Object.entries(s.rooms).forEach(([a,d])=>{const{room:n}=d;!te(n)&&!re(n)?l[a]=d:t===a&&(t=null)}),!t&&Object.keys(l).length>0&&(t=Object.keys(l)[0]),{rooms:l,activeRoomCode:t}})},getRoomsOfType:s=>{const l=o();return Object.values(l.rooms).filter(t=>t.room.roomType===s)},getActiveRoom:()=>{const s=o();return s.activeRoomCode&&s.rooms[s.activeRoomCode]||null},setCurrentPlayer:s=>{r({currentPlayer:s})}}),{name:"multi-room-storage",partialize:r=>({rooms:r.rooms,activeRoomCode:r.activeRoomCode,currentPlayer:r.currentPlayer}),onRehydrateStorage:()=>r=>{r?.rooms&&Object.values(r.rooms).forEach(o=>{o.room.createdAt&&typeof o.room.createdAt=="string"&&(o.room.createdAt=new Date(o.room.createdAt)),o.room.lastActivity&&typeof o.room.lastActivity=="string"&&(o.room.lastActivity=new Date(o.room.lastActivity)),o.room.expiresAt&&typeof o.room.expiresAt=="string"&&(o.room.expiresAt=new Date(o.room.expiresAt)),o.lastSync&&typeof o.lastSync=="string"&&(o.lastSync=new Date(o.lastSync))})}})));function T({player:r,className:o="",size:s="medium"}){const[l,t]=f.useState([]),[a,d]=f.useState(r.currentScore||0);f.useEffect(()=>{const m=r.currentScore||0,p=m-a;if(p!==0&&a!==void 0){const x={id:Date.now().toString(),points:p,type:p>0?"positive":"negative",timestamp:Date.now()};t(h=>[...h,x]),setTimeout(()=>{t(h=>h.filter(w=>w.id!==x.id))},2e3)}d(m)},[r.currentScore,a]);const n={small:"text-sm",medium:"text-base",large:"text-lg"},i=r.currentScore||0;return e.jsxs("div",{className:`relative inline-flex items-center space-x-2 ${o}`,children:[e.jsx("div",{className:`font-semibold ${n[s]} ${i>0?"text-cyan-400":"text-apple-secondary"}`,children:i}),e.jsx("div",{className:"absolute left-full ml-2 pointer-events-none",children:l.map(m=>e.jsxs("div",{className:`absolute whitespace-nowrap font-bold text-sm ${m.type==="positive"?"text-cyan-400":"text-red-400"} animate-score-float`,style:{animation:"scoreFloat 2s ease-out forwards",top:`${(l.length-l.indexOf(m)-1)*20}px`},children:[m.type==="positive"?"+":"",m.points]},m.id))})]})}function ne({players:r,currentPlayerId:o,className:s="",compact:l=!1}){const t=f.useMemo(()=>[...r].sort((n,i)=>{const m=n.currentScore||0,p=i.currentScore||0;return m!==p?p-m:n.name.localeCompare(i.name)}),[r]),a=t.length>0&&t[0].currentScore||0,d=t.filter(n=>(n.currentScore||0)===a&&a>0);return r.length===0?e.jsxs("div",{className:`apple-panel p-4 ${s}`,children:[e.jsx("h3",{className:"text-sm font-medium text-apple-secondary mb-2",children:"Leaderboard"}),e.jsx("p",{className:"text-xs text-apple-tertiary",children:"No players yet"})]}):l?e.jsxs("div",{className:`space-y-2 ${s}`,children:[e.jsxs("h3",{className:"text-sm font-medium text-apple-secondary mb-2",children:["Leaderboard (",r.length,")"]}),e.jsxs("div",{className:"space-y-1",children:[t.slice(0,5).map((n,i)=>{const m=d.some(x=>x.id===n.id),p=n.id===o;return e.jsxs("div",{className:`flex items-center justify-between px-3 py-2 rounded-lg text-sm ${p?"bg-apple-accent/20 border border-apple-accent/30":"bg-apple-darkest"}`,children:[e.jsxs("div",{className:"flex items-center space-x-2 flex-1 min-w-0",children:[e.jsxs("span",{className:`text-xs font-medium w-6 text-center ${i<3?"text-yellow-400":"text-apple-secondary"}`,children:["#",i+1]}),m&&e.jsx("span",{className:"text-yellow-400 text-sm crown-animate",title:"Current Leader",children:"👑"}),e.jsx("span",{className:`font-medium truncate ${p?"text-apple-accent":"text-apple-text"}`,children:n.name}),p&&e.jsx("span",{className:"text-xs text-apple-accent",children:"(You)"})]}),e.jsx(T,{player:n,size:"small"})]},n.id)}),t.length>5&&e.jsxs("div",{className:"text-xs text-apple-tertiary text-center pt-1",children:["+",t.length-5," more players"]})]})]}):e.jsxs("div",{className:`apple-panel p-6 ${s}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-apple-text",children:"Leaderboard"}),e.jsxs("span",{className:"text-sm text-apple-secondary",children:[r.length," ",r.length===1?"Player":"Players"]})]}),e.jsx("div",{className:"space-y-3",children:t.map((n,i)=>{const m=d.some(x=>x.id===n.id),p=n.id===o;return e.jsxs("div",{className:`flex items-center justify-between p-4 rounded-lg transition-colors ${p?"bg-apple-accent/20 border border-apple-accent/30":"bg-apple-darkest hover:bg-apple-hover"}`,children:[e.jsxs("div",{className:"flex items-center space-x-4 flex-1 min-w-0",children:[e.jsx("div",{className:`flex items-center justify-center w-8 h-8 rounded-full font-bold text-sm ${i===0?"bg-yellow-500 text-black":i===1?"bg-gray-400 text-black":i===2?"bg-amber-600 text-black":"bg-apple-border text-apple-text"}`,children:i+1}),m&&e.jsx("div",{className:"flex items-center",children:e.jsx("span",{className:"text-xl crown-animate",title:"Current Leader",children:"👑"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`font-semibold truncate ${p?"text-apple-accent":"text-apple-text"}`,children:n.name}),n.isHost&&e.jsx("span",{className:"text-yellow-400 text-xs font-medium px-2 py-1 bg-yellow-900/20 rounded-full",children:"Host"}),p&&e.jsx("span",{className:"text-apple-accent text-xs font-medium px-2 py-1 bg-apple-accent/20 rounded-full",children:"You"})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${n.isConnected?"bg-green-400":"bg-red-400"}`}),e.jsx("span",{className:"text-xs text-apple-secondary",children:n.isConnected?"Online":"Offline"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{player:n,size:"large"}),e.jsx("span",{className:"text-xs text-apple-secondary",children:"pts"})]})]},n.id)})}),a>0&&e.jsxs("div",{className:"mt-6 pt-4 border-t border-apple-border",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-apple-secondary",children:[e.jsx("span",{children:"Game Progress"}),e.jsxs("span",{children:[a," points to lead"]})]}),e.jsx("div",{className:"mt-2 bg-apple-darker rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-cyan-500 to-cyan-400 transition-all duration-500",style:{width:`${Math.min(a/25*100,100)}%`}})})]})]})}const O=r=>r==="single"?"⏱️":"♾️",B=r=>r==="single"?"text-blue-400":"text-green-400",le=(r,o=12)=>r.length>o?`${r.substring(0,o)}...`:r;function oe({rooms:r,activeRoomCode:o,onRoomChange:s,onRoomClose:l}){const t=Object.entries(r);return t.length===0?null:t.length===1?e.jsx("div",{className:"border-b border-apple-border bg-apple-darkest",children:e.jsx("div",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`text-sm ${B(t[0][1].room.roomType)}`,children:O(t[0][1].room.roomType)}),e.jsx("span",{className:"text-sm font-medium text-apple-text",children:t[0][1].room.name}),e.jsx("span",{className:"text-xs text-apple-secondary font-mono bg-apple-darkest px-2 py-1 rounded",children:t[0][1].room.code})]})})}):e.jsxs("div",{className:"border-b border-apple-border bg-apple-darkest",children:[e.jsxs("div",{className:"flex overflow-x-auto scrollbar-hide",children:[t.map(([a,d])=>{const n=o===a,{room:i}=d;return e.jsxs("div",{className:`
                group relative flex items-center space-x-2 px-4 py-3 cursor-pointer
                border-b-2 transition-all duration-200 flex-shrink-0 min-w-0
                ${n?"border-apple-accent bg-apple-accent/5":"border-transparent hover:bg-apple-darkest/80"}
              `,onClick:()=>s(a),children:[e.jsx("span",{className:`text-sm flex-shrink-0 ${B(i.roomType)}`,children:O(i.roomType)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:`text-sm font-medium truncate ${n?"text-apple-accent":"text-apple-text"}`,children:[e.jsx("span",{className:"hidden sm:inline",children:i.name}),e.jsx("span",{className:"sm:hidden",children:le(i.name)})]}),e.jsx("span",{className:`text-xs font-mono px-2 py-1 rounded flex-shrink-0 ${n?"bg-apple-accent/20 text-apple-accent":"bg-apple-darkest text-apple-secondary"}`,children:i.code})]}),e.jsxs("div",{className:"flex items-center space-x-1 mt-1",children:[e.jsx("div",{className:`w-1 h-1 rounded-full ${i.players.some(m=>m.isConnected)?"bg-green-400":"bg-apple-secondary"}`}),e.jsxs("span",{className:"text-xs text-apple-secondary",children:[i.players.length," player",i.players.length!==1?"s":""]})]})]}),e.jsx("button",{onClick:m=>{m.stopPropagation(),l(a)},className:`
                  w-5 h-5 rounded-full flex items-center justify-center flex-shrink-0
                  transition-all duration-200 opacity-0 group-hover:opacity-100
                  hover:bg-red-500/20 hover:text-red-400
                  ${n?"opacity-100":""}
                `,title:"Leave room",children:e.jsx("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})}),n&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-apple-accent"})]},a)}),e.jsx("div",{className:"flex-shrink-0 border-l border-apple-border/50",children:e.jsxs("button",{className:`
              h-full px-4 py-3 text-apple-secondary hover:text-apple-accent
              hover:bg-apple-darkest/80 transition-all duration-200
              flex items-center space-x-2
            `,title:"Create or join another room",onClick:()=>{},children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),e.jsx("span",{className:"text-sm font-medium hidden lg:inline",children:"Add Room"})]})})]}),e.jsx("div",{className:"sm:hidden flex justify-center py-1",children:e.jsx("div",{className:"flex space-x-1",children:t.map(([a])=>e.jsx("div",{className:`w-1 h-1 rounded-full transition-colors ${o===a?"bg-apple-accent":"bg-apple-border"}`},a))})})]})}function ce({selectedType:r,onTypeChange:o,disabled:s=!1,compact:l}){const[t,a]=f.useState(!1);return f.useEffect(()=>{if(l!==void 0){a(l);return}const d=()=>{a(window.innerWidth>=768)};return d(),window.addEventListener("resize",d),()=>window.removeEventListener("resize",d)},[l]),t?e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-apple-secondary",children:"Room Type"}),e.jsxs("div",{className:`
          flex rounded-lg border border-apple-border bg-apple-darkest overflow-hidden
          ${s?"opacity-50 cursor-not-allowed":""}
        `,children:[e.jsxs("button",{onClick:()=>!s&&o("single"),disabled:s,className:`
              room-type-compact-button flex-1 flex items-center justify-center px-3 py-2.5 text-sm font-medium 
              transition-all duration-200 relative overflow-hidden
              ${r==="single"?"text-white room-type-selected-gradient shadow-sm":"text-apple-secondary hover:text-apple-text hover:bg-apple-hover"}
              ${s?"cursor-not-allowed opacity-50":"cursor-pointer"}
            `,children:[e.jsx("span",{className:"text-base mr-2",children:"⏱️"}),"Meeting"]}),e.jsxs("button",{onClick:()=>!s&&o("persistent"),disabled:s,className:`
              room-type-compact-button flex-1 flex items-center justify-center px-3 py-2.5 text-sm font-medium 
              transition-all duration-200 relative overflow-hidden border-l border-apple-border
              ${r==="persistent"?"text-white room-type-selected-gradient shadow-sm":"text-apple-secondary hover:text-apple-text hover:bg-apple-hover"}
              ${s?"cursor-not-allowed opacity-50":"cursor-pointer"}
            `,children:[e.jsx("span",{className:"text-base mr-2",children:"♾️"}),"Continuous"]})]}),e.jsx("p",{className:"text-xs text-apple-secondary leading-relaxed",children:r==="single"?"One-time meeting room that auto-expires after 24 hours":"Continuous room that stays open indefinitely"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-apple-secondary mb-2",children:"Room Type"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:`
            relative p-4 rounded-lg border cursor-pointer transition-all duration-200
            ${r==="single"?"border-cyan-500 bg-cyan-500/10":"border-apple-border bg-apple-darkest hover:bg-apple-darkest/80"}
            ${s?"opacity-50 cursor-not-allowed":""}
          `,onClick:()=>!s&&o("single"),children:[e.jsx("div",{className:`
            absolute top-3 right-3 w-4 h-4 rounded-full border-2 transition-all
            ${r==="single"?"border-cyan-500 bg-cyan-500":"border-apple-border bg-transparent"}
          `,children:r==="single"&&e.jsx("div",{className:"w-full h-full rounded-full bg-white scale-50 transform"})}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500/20 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-lg",children:"⏱️"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-apple-text text-sm mb-1",children:"Meeting"}),e.jsx("p",{className:"text-xs text-apple-secondary leading-relaxed",children:"One-time use for specific meetings. Auto-expires after 24 hours or 2 hours of inactivity."}),e.jsxs("div",{className:"mt-2 flex items-center space-x-2 text-xs text-apple-secondary",children:[e.jsx("span",{className:"px-2 py-1 bg-blue-500/20 rounded text-blue-400 font-mono",children:"A4B7"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:"Perfect for one-off meetings"})]})]})]})]}),e.jsxs("div",{className:`
            relative p-4 rounded-lg border cursor-pointer transition-all duration-200
            ${r==="persistent"?"border-cyan-500 bg-cyan-500/10":"border-apple-border bg-apple-darkest hover:bg-apple-darkest/80"}
            ${s?"opacity-50 cursor-not-allowed":""}
          `,onClick:()=>!s&&o("persistent"),children:[e.jsx("div",{className:`
            absolute top-3 right-3 w-4 h-4 rounded-full border-2 transition-all
            ${r==="persistent"?"border-cyan-500 bg-cyan-500":"border-apple-border bg-transparent"}
          `,children:r==="persistent"&&e.jsx("div",{className:"w-full h-full rounded-full bg-white scale-50 transform"})}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-500/20 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-lg",children:"♾️"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-apple-text text-sm mb-1",children:"Continuous"}),e.jsx("p",{className:"text-xs text-apple-secondary leading-relaxed",children:"Long-running room that stays open indefinitely. Perfect for ongoing games."}),e.jsxs("div",{className:"mt-2 flex items-center space-x-2 text-xs text-apple-secondary",children:[e.jsx("span",{className:"px-2 py-1 bg-green-500/20 rounded text-green-400 font-mono",children:"X9K2"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:"Never expires"})]})]})]})]})]}),e.jsx("div",{className:"mt-3 p-3 bg-apple-darkest/50 rounded-lg",children:r==="single"?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-xs",children:[e.jsx("span",{className:"w-1 h-1 bg-blue-400 rounded-full"}),e.jsx("span",{className:"text-apple-secondary",children:"Room automatically expires after 24 hours or 2 hours of inactivity"})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-xs",children:[e.jsx("span",{className:"w-1 h-1 bg-blue-400 rounded-full"}),e.jsx("span",{className:"text-apple-secondary",children:"Perfect for one-time meetings, workshops, or events"})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-xs",children:[e.jsx("span",{className:"w-1 h-1 bg-blue-400 rounded-full"}),e.jsx("span",{className:"text-apple-secondary",children:"Scores reset with each new game session"})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-xs",children:[e.jsx("span",{className:"w-1 h-1 bg-green-400 rounded-full"}),e.jsx("span",{className:"text-apple-secondary",children:"Room stays open indefinitely - never expires"})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-xs",children:[e.jsx("span",{className:"w-1 h-1 bg-green-400 rounded-full"}),e.jsx("span",{className:"text-apple-secondary",children:"Maintains game state and player progress over time"})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-xs",children:[e.jsx("span",{className:"w-1 h-1 bg-green-400 rounded-full"}),e.jsx("span",{className:"text-apple-secondary",children:"Perfect for continuous play and long-term games"})]})]})})]})}function xe(){const[r,o]=f.useState(""),[s,l]=f.useState(""),[t,a]=f.useState(""),[d,n]=f.useState("single"),[i,m]=f.useState(!1),[p,x]=f.useState(""),[h,w]=f.useState({}),{playerName:v,isConnecting:b,isConnected:R,connectionError:A,setPlayerName:H}=X(),{rooms:C,activeRoomCode:k,currentPlayer:g,createRoom:z,joinRoom:I,leaveRoom:S,setActiveRoom:F,getActiveRoom:q,cleanupExpiredRooms:$}=ae(),u=q()?.room||null,y=Object.keys(C).length>0;f.useEffect(()=>{!t&&v&&a(v)},[v,t]),f.useEffect(()=>{const c=setInterval(()=>{$()},3e5);return()=>clearInterval(c)},[$]),f.useEffect(()=>{if(!u?.players)return;u.players.forEach(j=>{const J=j.currentScore||0,D=h[j.id]||0,N=J-D;if(N!==0&&D!==void 0&&h[j.id]!==void 0)if(j.id===g?.id){const W=G(N);_(N,W)}else N>0&&Q(`${j.name} scored ${N} points!`,void 0,"success")});const c={};u.players.forEach(j=>{c[j.id]=j.currentScore||0}),w(c)},[u?.players,g?.id,h]);const G=c=>c===10?"Square verified!":c===50?"3-in-a-row bonus!":c===100?"4-in-a-row bonus!":c===200?"BINGO achieved!":c===-50?"Self-claim penalty":c>0?`+${c} points earned`:`${c} points penalty`,U=c=>{const j=c.trim().toUpperCase();return/^[A-Z0-9]{4}$/.test(j)||/^[A-Z0-9]{6}$/.test(j)||/^(MTG|TEAM)-[A-Z0-9]{4}$/.test(j)},P=()=>{const c=t.trim();c.length>=2&&c.length<=30?(H(c),x("")):x("Name must be 2-30 characters")},L=async()=>{if(!r.trim()){x("Room name is required");return}if(!v){x("Set your name first");return}x("");const c=await z(r.trim(),v,d);c.success?(o(""),m(!1)):x(c.error||"Could not create room")},E=async()=>{if(!s.trim()){x("Room code is required");return}if(!U(s)){x("Enter a 4-character room code");return}if(!v){x("Set your name first");return}x("");const c=await I(s.toUpperCase(),v);c.success?l(""):x(c.error||"Could not join room")},M=c=>{c?S(c):k&&S(k),x("")};return e.jsxs("div",{className:"flex flex-col h-full",children:[y&&e.jsx(oe,{rooms:C,activeRoomCode:k,onRoomChange:F,onRoomClose:M}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[(p||A)&&e.jsx("div",{className:"bg-red-900/20 border border-red-500/30 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-red-500"}),e.jsx("p",{className:"text-red-300 text-sm font-medium",children:p||A})]})}),!v&&e.jsxs("div",{className:"apple-panel p-4 bg-yellow-900/10 border-yellow-500/30",children:[e.jsx("h2",{className:"text-lg font-semibold text-apple-text mb-2",children:"Player Setup"}),e.jsx("p",{className:"text-apple-secondary text-sm mb-3",children:"Set your name to continue"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"text",value:t,onChange:c=>a(c.target.value),className:"apple-input w-full",placeholder:"Your name",maxLength:30,onKeyPress:c=>c.key==="Enter"&&P()}),e.jsx("button",{onClick:P,disabled:!t.trim()||b,className:"apple-button w-full justify-center",children:"Set Name"})]})]}),u&&e.jsxs("div",{className:"apple-panel p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`text-base ${u.roomType==="single"?"text-blue-400":"text-green-400"}`,children:u.roomType==="single"?"⏱️":"♾️"}),e.jsx("h2",{className:"text-base font-semibold text-apple-text",children:"Current Room"}),e.jsx("span",{className:`px-2 py-0.5 text-xs rounded font-medium ${u.roomType==="single"?"bg-blue-500/20 text-blue-400":"bg-green-500/20 text-green-400"}`,children:u.roomType==="single"?"Meeting":"Team"})]}),e.jsx("button",{onClick:()=>M(),disabled:b,className:"px-3 py-1.5 bg-red-600 hover:bg-red-700 disabled:bg-apple-darkest disabled:cursor-not-allowed text-white rounded-md font-medium transition-colors text-xs",children:"Leave"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-apple-accent font-medium text-base",children:u.name}),u.roomType==="single"&&u.expiresAt&&e.jsxs("p",{className:"text-xs text-apple-secondary mt-0.5",children:["Expires: ",new Date(u.expiresAt).toLocaleDateString()," at"," ",new Date(u.expiresAt).toLocaleTimeString()]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsx("div",{className:"col-span-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-apple-secondary",children:"Room Code"}),e.jsx("span",{className:"font-mono text-apple-accent bg-apple-darkest px-2 py-0.5 rounded text-sm",children:u.code})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-apple-secondary text-xs",children:"Players"}),e.jsxs("span",{className:"text-apple-text text-xs",children:[u.players.length,"/",u.maxPlayers||10]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-apple-secondary text-xs",children:"Status"}),e.jsxs("div",{className:`flex items-center space-x-1 ${R?"text-green-400":"text-red-400"}`,children:[e.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${R?"bg-green-400":"bg-red-400"}`}),e.jsx("span",{className:"text-xs",children:R?"Connected":"Offline"})]})]}),e.jsxs("div",{className:"col-span-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-apple-secondary text-xs",children:"Your Name"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"text-apple-text text-xs",children:g?.name}),g?.isHost&&e.jsx("span",{className:"text-yellow-400 text-xs",children:"(Host)"})]})]})]}),e.jsx("div",{className:"mt-4 pt-3 border-t border-apple-border",children:e.jsx(ne,{players:u.players,currentPlayerId:g?.id,compact:!0})})]}),(!y||i)&&v&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"apple-panel p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-base font-semibold text-apple-text",children:"Create Room"}),y&&e.jsx("button",{onClick:()=>m(!1),className:"text-apple-secondary hover:text-apple-text transition-colors",children:e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(ce,{selectedType:d,onTypeChange:n,disabled:b,compact:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-apple-secondary mb-2",children:"Room Name"}),e.jsx("input",{type:"text",value:r,onChange:c=>o(c.target.value),className:"apple-input w-full",placeholder:d==="single"?"Meeting name":"Team name",maxLength:50,disabled:b,onKeyPress:c=>c.key==="Enter"&&L()})]}),e.jsx("button",{onClick:L,disabled:!r.trim()||b,className:"apple-button w-full justify-center bg-emerald-600 hover:bg-emerald-700",children:`Create ${d==="single"?"Meeting":"Team"} Room`})]})]}),e.jsxs("div",{className:"apple-panel p-4",children:[e.jsx("h2",{className:"text-base font-semibold text-apple-text mb-3",children:"Join Room"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-apple-secondary mb-2",children:"Room Code"}),e.jsx("input",{type:"text",value:s,onChange:c=>l(c.target.value.toUpperCase()),className:"apple-input w-full text-center font-mono tracking-wider",placeholder:"e.g. A1B2",maxLength:4,disabled:b,onKeyPress:c=>c.key==="Enter"&&E()}),e.jsx("p",{className:"text-xs text-apple-secondary mt-1",children:"Enter the 4-character room code"})]}),e.jsx("button",{onClick:E,disabled:!s.trim()||b,className:"apple-button w-full justify-center",children:"Join Room"})]})]})]}),y&&!i&&v&&e.jsx("div",{className:"apple-panel p-4",children:e.jsxs("button",{onClick:()=>m(!0),className:"apple-button w-full justify-center bg-emerald-600 hover:bg-emerald-700",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Create Another Room"]})}),!y&&e.jsxs("div",{className:"apple-panel p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-apple-text mb-4",children:"Game Features"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-apple-accent/20 rounded-full flex items-center justify-center mx-auto mb-2",children:e.jsx("span",{className:"text-xl",children:"🎯"})}),e.jsx("h3",{className:"font-medium text-apple-text text-sm mb-1",children:"Unique Boards"}),e.jsx("p",{className:"text-xs text-apple-secondary",children:"Unique cards for each player"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-apple-accent/20 rounded-full flex items-center justify-center mx-auto mb-2",children:e.jsx("span",{className:"text-xl",children:"⚡"})}),e.jsx("h3",{className:"font-medium text-apple-text text-sm mb-1",children:"Real-time"}),e.jsx("p",{className:"text-xs text-apple-secondary",children:"Instant synchronization"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-apple-accent/20 rounded-full flex items-center justify-center mx-auto mb-2",children:e.jsx("span",{className:"text-xl",children:"⏱️"})}),e.jsx("h3",{className:"font-medium text-apple-text text-sm mb-1",children:"Meeting Rooms"}),e.jsx("p",{className:"text-xs text-apple-secondary",children:"Auto-expire after meetings"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-apple-accent/20 rounded-full flex items-center justify-center mx-auto mb-2",children:e.jsx("span",{className:"text-xl",children:"♾️"})}),e.jsx("h3",{className:"font-medium text-apple-text text-sm mb-1",children:"Team Rooms"}),e.jsx("p",{className:"text-xs text-apple-secondary",children:"Persistent with leaderboards"})]})]})]})]})]})}export{xe as RoomManager};
